import{j as e}from"./ui-vendor-C0wu6Ixu.js";import{r as m}from"./react-vendor-CaWBk0BP.js";import{B as h}from"./button-D17X8cRn.js";import{C as U}from"./CVSourceStep-C4zq4Pi5.js";import{s as o,a as k}from"./index-WJiHffTg.js";import{a as q,u as F}from"./router-vendor-CjcZkGkV.js";import{C as H}from"./circle-alert-3PTuTpgo.js";import{H as b}from"./house-DHGSPX3-.js";import{C as L}from"./chevron-left-CjnhyJjb.js";import"./card-Dm6-Ikt0.js";import"./checkbox-rrAgDuXb.js";import"./index-CS5Pkq6r.js";import"./check-BfkMwFy4.js";import"./badge-DETtUbOb.js";import"./input-B1s9sH2A.js";import"./tabs-BYo5RIDV.js";import"./file-text-CGllT9L0.js";import"./search-2qrMKekl.js";import"./upload-gJ4h4gTs.js";import"./calendar-BTwJ4JLG.js";import"./supabase-vendor-ChaIFbZk.js";import"./query-vendor-Dx0-x9wB.js";function ce(){var w,y;const{brandId:x}=q(),i=F(),[s,V]=m.useState(null),[_,B]=m.useState(!0),[E,j]=m.useState(!1),[N,v]=m.useState(null);m.useEffect(()=>{x&&S()},[x]);const S=async()=>{try{const{data:{user:n}}=await o.auth.getUser();if(!n)throw new Error("Not authenticated");const{data:u,error:d}=await o.from("brands").select("*").eq("id",x).eq("user_id",n.id).single();if(d)throw d;V(u)}catch(n){console.error("Error fetching brand:",n),v("Failed to load brand information")}finally{B(!1)}},D=async(n,u)=>{var d;if(s){j(!0);try{const{data:{user:a}}=await o.auth.getUser();if(!a)throw new Error("Not authenticated");const t=s.raw_context,f=t==null?void 0:t.styleData;if(!f)throw new Error("Brand style data not found");const{data:r}=await o.from("profiles").select("*").eq("id",a.id).single(),G={name:(r==null?void 0:r.display_name)||"Professional Name",role:((d=r==null?void 0:r.role_tags)==null?void 0:d[0])||"Professional",bio:(r==null?void 0:r.bio)||f.bio,links:r!=null&&r.socials?Object.entries(r.socials).map(([g,l])=>({label:g,url:l})):[]},I=(t!=null&&t.uploadIds?(await Promise.all(t.uploadIds.map(async g=>{const{data:l}=await o.from("uploads").select("extracted_text").eq("id",g).single();return(l==null?void 0:l.extracted_text)||""}))).join(`

`):"")+(u?`

`+u:""),p=await o.functions.invoke("generate-cv",{body:{styleData:f,extractedText:I,format:s.format_preset,userProfile:G,sourceUploadIds:n}});if(p.error)throw p.error;const c=p.data,{data:P,error:C}=await o.from("cvs").insert({user_id:a.id,title:`${c.name} - CV`,summary:c.summary,experience:c.experience,skills:c.skills,links:c.links,format_preset:s.format_preset}).select().single();if(C)throw C;k.success("CV generated successfully!"),i(`/cv/${P.id}`)}catch(a){console.error("CV generation error:",a),v(a.message||"Failed to generate CV"),k.error(a.message||"Failed to generate CV")}finally{j(!1)}}};return _?e.jsx("div",{className:"min-h-screen bg-background py-12",children:e.jsx("div",{className:"container max-w-4xl mx-auto px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading brand information..."})]})})}):N||!s?e.jsx("div",{className:"min-h-screen bg-background py-12",children:e.jsx("div",{className:"container max-w-4xl mx-auto px-4",children:e.jsx("div",{className:"bg-surface/50 border border-border rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-red-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"font-heading text-3xl text-foreground",children:"Brand Not Found"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:N||"The brand you're trying to generate a CV from could not be found."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsxs(h,{onClick:()=>i("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Go to Dashboard"]}),e.jsxs(h,{variant:"outline",onClick:()=>i("/"),className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Go Home"]})]})]})})})}):E?e.jsx("div",{className:"min-h-screen bg-background py-12",children:e.jsx("div",{className:"container max-w-4xl mx-auto px-4",children:e.jsx("div",{className:"bg-surface/50 border border-border rounded-2xl p-8 shadow-lg",children:e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"font-heading text-3xl",children:"Generating Your CV"}),e.jsx("p",{className:"text-muted-foreground",children:"Creating a professional CV using your brand style..."})]})]})})})}):e.jsx("div",{className:"min-h-screen bg-background py-12",children:e.jsxs("div",{className:"container max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(h,{variant:"ghost",onClick:()=>i(`/brand/${x}`),children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Back to Brand"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>i("/dashboard"),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"Dashboard"]})})]}),e.jsxs("div",{className:"bg-surface/50 border border-border rounded-2xl p-8 shadow-lg",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"font-heading text-3xl mb-2",children:"Generate CV from Brand"}),e.jsxs("p",{className:"text-muted-foreground",children:["Using style from: ",e.jsx("span",{className:"font-medium",children:s.title})]})]}),e.jsx(U,{brandCorpus:((w=s.raw_context)==null?void 0:w.markdown)||"",brandUploadIds:((y=s.raw_context)==null?void 0:y.uploadIds)||[],onComplete:D})]})]})})}export{ce as default};
