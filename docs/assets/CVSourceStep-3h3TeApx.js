import{j as e}from"./ui-vendor-C0wu6Ixu.js";import{r as o}from"./react-vendor-CaWBk0BP.js";import{B as u}from"./button-D0nBzFIi.js";import{C as Q,c as Y}from"./card-CwGfeh1M.js";import{C as O,f as H}from"./checkbox-Bdf6tCxa.js";import{B as b}from"./badge-DIdVrDCd.js";import{I as J}from"./input-CJw-rrwE.js";import{T as W,a as X,b as $,c as z}from"./tabs-B0MGJ9wM.js";import{c as Z,s as h,a as g}from"./index-DuW-Yr95.js";import{F as j}from"./file-text-_TkRN8CW.js";import{S as ee}from"./search-BYOnwMcq.js";import{C as se}from"./circle-alert-ixkHJXJq.js";import{U as te}from"./upload-DcScQ5z3.js";import{C as ae}from"./calendar-ZbfWttRB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=Z("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function Ne({brandCorpus:n,brandUploadIds:c,onComplete:N}){const[l,y]=o.useState([]),[r,d]=o.useState(c),[x,E]=o.useState(""),[V,A]=o.useState(!0),[M,v]=o.useState("existing"),[m,w]=o.useState([]),[S,U]=o.useState(!1);o.useEffect(()=>{_()},[]);const _=async()=>{try{const{data:{user:s}}=await h.auth.getUser();if(!s)throw new Error("Not authenticated");const{data:t,error:a}=await h.from("uploads").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(a)throw a;y(t||[])}catch(s){console.error("Error fetching uploads:",s),g.error("Failed to load your uploads")}finally{A(!1)}},q=s=>{if(s.target.files){const t=Array.from(s.target.files);w(t)}},G=async()=>{if(m.length!==0){U(!0);try{const{data:{user:s}}=await h.auth.getUser();if(!s)throw new Error("Not authenticated");const t=[];for(const a of m)try{let i="";a.type==="text/plain"?i=await a.text():i=`Content from ${a.name} - professional document with relevant CV information.`;const f=`${s.id}/${Date.now()}_${a.name}`,{error:L}=await h.storage.from("uploads").upload(f,a);if(L)throw L;const{data:P,error:T}=await h.from("uploads").insert({user_id:s.id,storage_path:f,original_name:a.name,mime_type:a.type,size_bytes:a.size,extracted_text:i}).select().single();if(T)throw T;t.push(P.id)}catch(i){console.error(`Error processing ${a.name}:`,i),g.error(`Failed to process ${a.name}`)}t.length>0&&(d(a=>[...a,...t]),await _(),g.success(`${t.length} files uploaded successfully`),w([]),v("existing"))}catch(s){console.error("Upload error:",s),g.error("Failed to upload files")}finally{U(!1)}}},F=(s,t)=>{d(t?a=>[...a,s]:a=>a.filter(i=>i!==s))},R=s=>{d(s?C.map(t=>t.id):[])},I=()=>{const t=l.filter(a=>r.includes(a.id)).filter(a=>!c.includes(a.id)).map(a=>a.extracted_text).join(`

`);N(r,t)},C=l.filter(s=>{const t=x.toLowerCase();return s.original_name.toLowerCase().includes(t)||s.extracted_text.toLowerCase().includes(t)}),k=l.filter(s=>c.includes(s.id)),B=l.filter(s=>!c.includes(s.id)),p=r.length,K=l.filter(s=>r.includes(s.id)).reduce((s,t)=>s+t.extracted_text.length,0);return V?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading your uploads..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-medium",children:[e.jsx(j,{className:"w-4 h-4"}),"CV Generation - Step 2 of 2"]})}),e.jsx("h2",{className:"font-heading text-3xl mb-2",children:"Select CV Sources"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Choose which documents to use for generating your CV. Your brand documents are already selected, but you can add more files or upload new ones for a more comprehensive CV."})]}),e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:[p," document",p!==1?"s":""," selected"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[K.toLocaleString()," characters of content"]}),p>0&&e.jsx("p",{className:"text-xs text-primary mt-1",children:"Ready to generate your professional CV ✨"})]})]}),e.jsxs(u,{onClick:I,disabled:p===0,className:"gap-2",size:"lg",children:["Generate CV",e.jsx(j,{className:"w-4 h-4"})]})]})}),e.jsxs(W,{value:M,onValueChange:v,children:[e.jsxs(X,{className:"grid w-full grid-cols-2",children:[e.jsxs($,{value:"existing",children:["Your Documents (",l.length,")"]}),e.jsx($,{value:"upload",children:"Upload New"})]}),e.jsxs(z,{value:"existing",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{placeholder:"Search your documents...",value:x,onChange:s=>E(s.target.value),className:"pl-10"})]}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>R(r.length!==C.length),children:r.length===C.length?"Deselect All":"Select All"})]}),k.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"default",className:"text-xs",children:"Brand Documents"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Used to create your brand (automatically included)"}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded px-2 py-1",children:e.jsx("span",{className:"text-xs text-blue-700 font-medium",children:"✓ Pre-selected for consistency"})})})]}),e.jsx("div",{className:"grid gap-3",children:k.map(s=>e.jsx(D,{upload:s,isSelected:r.includes(s.id),onSelect:t=>F(s.id,t),isBrandDocument:!0},s.id))})]}),B.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",className:"text-xs",children:"Other Documents"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Additional files you can include"})]}),e.jsx("div",{className:"grid gap-3",children:B.filter(s=>{const t=x.toLowerCase();return s.original_name.toLowerCase().includes(t)||s.extracted_text.toLowerCase().includes(t)}).map(s=>e.jsx(D,{upload:s,isSelected:r.includes(s.id),onSelect:t=>F(s.id,t),isBrandDocument:!1},s.id))})]}),l.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"font-medium mb-2",children:"No documents found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload some documents to get started with CV generation."}),e.jsx(u,{onClick:()=>v("upload"),children:"Upload Documents"})]})]}),e.jsxs(z,{value:"upload",className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-border rounded-xl p-8 text-center",children:[e.jsx(te,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-primary hover:text-primary/80 font-medium",children:"Choose additional files"}),e.jsx("input",{type:"file",multiple:!0,accept:".txt,.md,.pdf,.docx,.doc,.png,.jpg,.jpeg",onChange:q,className:"sr-only"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Upload resumes, cover letters, or other professional documents"})]}),m.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-medium",children:["Files to Upload (",m.length,")"]}),e.jsx("div",{className:"space-y-2",children:m.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.type," • ",(s.size/1024).toFixed(1)," KB"]})]})]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>w(a=>a.filter((i,f)=>f!==t)),children:"Remove"})]},t))}),e.jsx(u,{onClick:G,disabled:S,className:"w-full",children:S?"Uploading...":`Upload ${m.length} File${m.length!==1?"s":""}`})]})]})]})]})}function D({upload:n,isSelected:c,onSelect:N,isBrandDocument:l}){const y=r=>{const d=["B","KB","MB","GB"],x=Math.floor(Math.log(r)/Math.log(1024));return`${(r/Math.pow(1024,x)).toFixed(1)} ${d[x]}`};return e.jsx(Q,{className:`cursor-pointer transition-all ${c?"ring-2 ring-primary bg-primary/5":"hover:shadow-md"}`,children:e.jsx(Y,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{checked:c,onCheckedChange:N,className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(j,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsx("h3",{className:"font-medium text-sm truncate",children:n.original_name}),l&&e.jsx(b,{variant:"default",className:"text-xs",children:"Brand"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:[n.mime_type," • ",y(n.size_bytes)," • ",n.extracted_text.length," chars"]}),e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-2",children:[n.extracted_text.substring(0,150),"..."]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ae,{className:"w-3 h-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(new Date(n.updated_at||n.created_at),{addSuffix:!0})})]})]})]})})})}export{Ne as C};
