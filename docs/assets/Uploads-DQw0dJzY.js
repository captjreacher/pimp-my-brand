import{j as e}from"./ui-vendor-C0wu6Ixu.js";import{r as l}from"./react-vendor-CaWBk0BP.js";import{s as m,a as c}from"./index-WJiHffTg.js";import{B as x}from"./button-D17X8cRn.js";import{C as k,a as z,b as P,d as $,c as B}from"./card-Dm6-Ikt0.js";import{I as E}from"./input-B1s9sH2A.js";import{T as Q}from"./textarea-D8pH1jHG.js";import{T as ee,a as se,b as A,c as I}from"./tabs-BYo5RIDV.js";import{B as te}from"./badge-DETtUbOb.js";import{f as R,F as ae}from"./file-processing-CWs_DEtq.js";import{u as re}from"./router-vendor-CjcZkGkV.js";import{A as oe}from"./arrow-left-Xh3ji4Sq.js";import{L as ne}from"./log-out-DeQH8INX.js";import{U as W}from"./upload-gJ4h4gTs.js";import{F as g}from"./file-text-CGllT9L0.js";import{I as M}from"./image-ImTtwPeG.js";import{L as j}from"./loader-circle-C-FtpdMo.js";import{D as ie}from"./download--9-3Bn8B.js";import"./supabase-vendor-ChaIFbZk.js";import"./query-vendor-Dx0-x9wB.js";async function le(i,d){try{return R.canProcess(i,d==null?void 0:d.enabled)?await R.extractText(i,d):`[Unsupported file type: ${i.name}]`}catch(a){return a instanceof ae?(console.error("File processing error:",a.message),`[Error processing ${i.name}: ${a.message}]`):(console.error("Unexpected error during file processing:",a),`[Error processing ${i.name}: Unexpected error occurred]`)}}const Fe=()=>{const i=re(),d=l.useRef(null),[a,b]=l.useState(null),[Y,q]=l.useState(!0),[u,y]=l.useState([]),[N,w]=l.useState(""),[h,v]=l.useState(""),[U,K]=l.useState([]),[G,S]=l.useState(!0),[T,_]=l.useState(!1),[C,F]=l.useState(!1);l.useEffect(()=>{(async()=>{const{data:{session:r}}=await m.auth.getSession();b(r),r?p(r.user.id):i("/auth"),q(!1)})();const{data:{subscription:t}}=m.auth.onAuthStateChange((r,o)=>{b(o),o?p(o.user.id):i("/auth")});return()=>{t.unsubscribe()}},[i]);const p=async s=>{try{S(!0);const{data:t,error:r}=await m.from("uploads").select("*").eq("user_id",s).order("created_at",{ascending:!1});if(r)throw r;const o=(t||[]).map(n=>{if(n.mime_type&&n.mime_type.startsWith("image/")){const{data:f}=m.storage.from("uploads").getPublicUrl(n.storage_path);return{...n,previewUrl:f.publicUrl}}return n});K(o)}catch(t){console.error("Failed to load uploads",t),c.error(t.message??"Unable to load uploads")}finally{S(!1)}},H=s=>{s.target.files&&y(Array.from(s.target.files))},O=(s,t)=>{const r=s.replace(/[^a-zA-Z0-9.\-_]/g,"_"),o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).slice(2,10)}`;return`${t}/${o}-${r}`},L=async(s,t,r)=>{const o=O(s.name,t),{error:n}=await m.storage.from("uploads").upload(o,s);if(n)throw n;const f=r??await le(s),{error:D}=await m.from("uploads").insert({user_id:t,storage_path:o,original_name:s.name,mime_type:s.type,size_bytes:s.size,extracted_text:f});if(D)throw D},V=async()=>{if(!(a!=null&&a.user)){c.error("You must be signed in to upload files");return}if(u.length===0){c.error("Please choose at least one file");return}_(!0);try{for(const s of u)await L(s,a.user.id);c.success("Files uploaded successfully"),y([]),d.current&&(d.current.value=""),await p(a.user.id)}catch(s){console.error("Failed to upload files",s),c.error(s.message??"Unable to upload files")}finally{_(!1)}},X=async s=>{if(s.preventDefault(),!(a!=null&&a.user)){c.error("You must be signed in to save text uploads");return}if(!h.trim()){c.error("Please add some text content");return}F(!0);try{const o=`${(N.trim()||"Untitled Note").toLowerCase().replace(/[^a-z0-9]+/g,"-")||"note"}.txt`,n=new File([h],o,{type:"text/plain"});await L(n,a.user.id,h),c.success("Text saved successfully"),w(""),v(""),await p(a.user.id)}catch(t){console.error("Failed to upload text",t),c.error(t.message??"Unable to upload text")}finally{F(!1)}},Z=async s=>{try{const{data:t,error:r}=await m.storage.from("uploads").download(s.storage_path);if(r)throw r;const o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=s.original_name,n.click(),URL.revokeObjectURL(o)}catch(t){console.error("Download failed",t),c.error(t.message??"Unable to download file")}},J=async()=>{await m.auth.signOut(),i("/")};return Y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"text-muted-foreground",children:"Checking your session..."})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-surface/30 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>i("/dashboard"),className:"gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Back to Dashboard"]}),e.jsx("h1",{className:"font-heading text-2xl font-bold",children:"User Uploads"})]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:J,className:"gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Sign Out"]})]})})}),e.jsx("main",{className:"container mx-auto px-6 py-12",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8",children:[e.jsxs(k,{children:[e.jsxs(z,{children:[e.jsx(P,{children:"Upload new content"}),e.jsx($,{children:"Bring your documents, images, and written content into your workspace. We store the file and capture the text so it can be used across the app."})]}),e.jsx(B,{children:e.jsxs(ee,{defaultValue:"files",className:"w-full",children:[e.jsxs(se,{className:"mb-6",children:[e.jsxs(A,{value:"files",className:"gap-2",children:[e.jsx(W,{className:"w-4 h-4"})," Files & Images"]}),e.jsxs(A,{value:"text",className:"gap-2",children:[e.jsx(g,{className:"w-4 h-4"})," Paste Text"]})]}),e.jsxs(I,{value:"files",children:[e.jsxs("div",{className:"border-2 border-dashed border-border rounded-xl p-6 text-center",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsxs("label",{className:"cursor-pointer font-medium text-primary hover:text-primary/80",children:["Choose files to upload",e.jsx(E,{ref:d,type:"file",multiple:!0,className:"hidden",accept:".txt,.md,.pdf,.doc,.docx,.png,.jpg,.jpeg,.gif",onChange:H})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Supported formats: TXT, Markdown, PDF, Word documents, and common image files up to 10MB."})]}),u.length>0&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground",children:["Selected files (",u.length,")"]}),e.jsx("div",{className:"space-y-2",children:u.map((s,t)=>e.jsx("div",{className:"flex items-center justify-between rounded-lg border border-border bg-surface/50 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.type.startsWith("image/")?e.jsx(M,{className:"w-4 h-4 text-primary"}):e.jsx(g,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[(s.size/1024).toFixed(1)," KB"]})]})]})},`${s.name}-${t}`))})]}),e.jsx(x,{onClick:V,disabled:u.length===0||T,className:"mt-6 w-full",size:"lg",children:T?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"})," Uploading..."]}):"Upload selected files"})]}),e.jsx(I,{value:"text",children:e.jsxs("form",{className:"space-y-4",onSubmit:X,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Title"}),e.jsx(E,{placeholder:"Give your text upload a title",value:N,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Content"}),e.jsx(Q,{placeholder:"Paste or write the content you want to store",rows:6,value:h,onChange:s=>v(s.target.value)})]}),e.jsx(x,{type:"submit",disabled:C,className:"w-full",size:"lg",children:C?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"})," Saving text..."]}):"Save text upload"})]})})]})})]}),e.jsxs(k,{children:[e.jsxs(z,{children:[e.jsx(P,{children:"Your uploads"}),e.jsx($,{children:"Access everything you have shared with the app. Download files again or review captured text summaries."})]}),e.jsx(B,{children:G?e.jsxs("div",{className:"flex items-center justify-center py-12 text-muted-foreground",children:[e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"})," Loading uploads..."]}):U.length===0?e.jsx("div",{className:"rounded-xl border border-dashed border-border py-12 text-center text-muted-foreground",children:e.jsx("p",{children:"No uploads yet. Start by adding files or text above."})}):e.jsx("div",{className:"grid gap-4",children:U.map(s=>{var t;return e.jsxs("div",{className:"grid gap-4 rounded-xl border border-border bg-surface/40 p-4 md:grid-cols-[auto,1fr,auto] md:items-center",children:[e.jsx("div",{className:"flex items-center justify-center rounded-lg bg-surface w-12 h-12",children:(t=s.mime_type)!=null&&t.startsWith("image/")?e.jsx(M,{className:"w-5 h-5 text-primary"}):e.jsx(g,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h3",{className:"font-medium",children:s.original_name}),s.mime_type&&e.jsx(te,{variant:"secondary",children:s.mime_type})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.created_at?new Date(s.created_at).toLocaleString():"Unknown date",typeof s.size_bytes=="number"&&e.jsxs("span",{className:"ml-2",children:["â€¢ ",(s.size_bytes/1024).toFixed(1)," KB"]})]}),s.extracted_text&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.extracted_text}),s.previewUrl&&e.jsx("img",{src:s.previewUrl,alt:s.original_name,className:"mt-2 max-h-48 rounded-lg object-cover"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>Z(s),children:[e.jsx(ie,{className:"w-4 h-4"}),"Download"]})})]},s.id)})})})]})]})})]})};export{Fe as default};
