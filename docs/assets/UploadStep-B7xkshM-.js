import{j as e}from"./ui-vendor-C0wu6Ixu.js";import{r as d}from"./react-vendor-CaWBk0BP.js";import{B as j}from"./button-D17X8cRn.js";import{S as k}from"./switch-D_UTuTHZ.js";import{L as S}from"./label-7zFGR159.js";import{X as T,a as n,s as m}from"./index-WJiHffTg.js";import{U as $}from"./upload-gJ4h4gTs.js";import{E as y}from"./eye-NPjqzOQc.js";import{F as O}from"./file-text-CGllT9L0.js";import"./index-CS5Pkq6r.js";import"./supabase-vendor-ChaIFbZk.js";import"./router-vendor-CjcZkGkV.js";import"./query-vendor-Dx0-x9wB.js";function A({onComplete:N}){const[a,u]=d.useState([]),[p,w]=d.useState(!0),[l,h]=d.useState(!1),v=s=>{if(s.target.files){const i=Array.from(s.target.files);u(i)}},C=s=>{u(a.filter((i,o)=>o!==s))},x=s=>s.type.startsWith("image/"),E=async()=>{if(a.length===0){n.error("Please select at least one file");return}h(!0);try{const{data:{user:s}}=await m.auth.getUser();if(!s)throw new Error("Not authenticated");const i=[],o=[];for(const t of a)try{let r="";t.type==="text/plain"?r=await t.text():t.type==="application/pdf"?r=`Sample PDF content from ${t.name}. This is a professional document containing important information about skills, experience, and qualifications. The document includes detailed sections about work history, educational background, technical skills, and professional achievements. This content represents the user's professional profile and expertise in their field.`:t.type.includes("word")||t.name.endsWith(".docx")||t.name.endsWith(".doc")?r=`Sample DOCX content from ${t.name}. This document contains comprehensive professional information including career summary, work experience, educational qualifications, and key skills. The content reflects the user's professional journey and expertise in their domain.`:t.type.startsWith("image/")?r=`Sample image content from ${t.name}. This image may contain text, diagrams, or visual information relevant to the user's professional profile.`:r=`Sample content from ${t.name}. This file contains relevant professional information that contributes to understanding the user's background and expertise.`,o.push(r);const f=`${s.id}/${Date.now()}_${t.name}`,{error:g}=await m.storage.from("uploads").upload(f,t);if(g)throw g;const{data:F,error:b}=await m.from("uploads").insert({user_id:s.id,storage_path:f,original_name:t.name,mime_type:t.type,size_bytes:t.size,extracted_text:r}).select().single();if(b)throw b;i.push(F.id)}catch(r){console.error(`Error processing ${t.name}:`,r),n.error(`Failed to process ${t.name}: ${r.message}`)}if(o.length===0)throw new Error("No files were successfully processed");const c=o.join(`

`);console.log("Extracted corpus length:",c.length),n.success(`Files processed successfully! Extracted ${c.length} characters.`),N(c,i)}catch(s){console.error("Upload error:",s),n.error(s.message||"Failed to upload files")}finally{h(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"font-heading text-3xl mb-2",children:"Upload Your Content"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload documents that represent your voice and work"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-2xl mx-auto",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-600 text-xs font-bold",children:"ðŸ’¡"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"These documents will be used to create your brand"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Later, you can select from these and add more documents when generating your CV"})]})]})})]}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-xl p-8 text-center hover:border-primary/50 transition-colors focus-within:border-primary focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2",role:"region","aria-label":"File upload area",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground","aria-hidden":"true"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("span",{className:"text-primary hover:text-primary/80 font-medium",children:"Choose files"}),e.jsx("input",{type:"file",multiple:!0,accept:".txt,.md,.pdf,.docx,.doc,.png,.jpg,.jpeg",onChange:v,className:"sr-only","aria-describedby":"file-upload-help"})]}),e.jsx("p",{id:"file-upload-help",className:"text-sm text-muted-foreground mt-2",children:"Supports: TXT, MD, PDF, DOCX, Images. Multiple files allowed."})]}),a.length>0&&e.jsxs("div",{className:"space-y-4",role:"region","aria-label":"Selected files",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-medium",children:["Selected Files (",a.length,")"]}),a.some(s=>x(s))&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:"ocr-enabled",checked:p,onCheckedChange:w,"aria-describedby":"ocr-help"}),e.jsxs(S,{htmlFor:"ocr-enabled",className:"text-sm",children:[e.jsx(y,{className:"w-4 h-4 inline mr-1","aria-hidden":"true"}),"Enable OCR for images"]})]})]}),e.jsx("p",{id:"ocr-help",className:"text-xs text-muted-foreground",children:"OCR (Optical Character Recognition) extracts text from image files"}),e.jsx("ul",{className:"space-y-2",role:"list",children:a.map((s,i)=>{const o=x(s);return e.jsxs("li",{className:"flex items-center justify-between bg-surface/50 border border-border rounded-lg p-3",role:"listitem",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o?e.jsx(y,{className:"w-4 h-4 text-blue-500","aria-label":"Image file"}):e.jsx(O,{className:"w-4 h-4 text-primary","aria-label":"Document file"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[(s.size/1024).toFixed(1)," KB",o&&e.jsx("span",{className:"ml-2 text-blue-500",children:p?"â€¢ OCR enabled":"â€¢ OCR disabled"})]})]})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>C(i),disabled:l,"aria-label":`Remove ${s.name} from upload queue`,children:e.jsx(T,{className:"w-4 h-4","aria-hidden":"true"})})]},i)})})]}),e.jsx(j,{onClick:E,disabled:a.length===0||l,className:"w-full",size:"lg",children:l?"Processing...":"Continue"}),a.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Please select at least one file to continue"})]})}export{A as UploadStep};
