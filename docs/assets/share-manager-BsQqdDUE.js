var h=Object.defineProperty;var p=(l,e,r)=>e in l?h(l,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[e]=r;var c=(l,e,r)=>p(l,typeof e!="symbol"?e+"":e,r);import{s as o}from"./index-WJiHffTg.js";class u{static async shareBrandRider(e,r={}){return this.createShare("brand",e,r)}static async shareCV(e,r={}){return this.createShare("cv",e,r)}static async getSharedContent(e){try{const{data:r,error:i}=await o.rpc("get_share_by_token",{_token:e});if(i||!r||r.length===0)return null;const n=r[0];let t,s;if(n.kind==="brand"){const{data:a,error:d}=await o.from("brands").select(`
            *,
            profiles!inner(display_name, handle, avatar_url)
          `).eq("id",n.target_id).single();if(d||!a)throw new Error("Brand not found");t=this.mapBrandToBrandRider(a),s=a.profiles}else{const{data:a,error:d}=await o.from("cvs").select(`
            *,
            profiles!inner(display_name, handle, avatar_url)
          `).eq("id",n.target_id).single();if(d||!a)throw new Error("CV not found");t=this.mapCVToCV(a),s=a.profiles}return{id:n.id,kind:n.kind,content:t,owner:{displayName:s.display_name,handle:s.handle,avatarUrl:s.avatar_url},createdAt:new Date(n.created_at),expiresAt:n.expires_at?new Date(n.expires_at):void 0}}catch(r){return console.error("Error fetching shared content:",r),null}}static async getUserShares(){try{const{data:e}=await o.auth.getUser();if(!e.user)throw new Error("User not authenticated");const{data:r,error:i}=await o.from("shares").select("*").eq("user_id",e.user.id).order("created_at",{ascending:!1});if(i)throw i;return await Promise.all(r.map(async t=>{let s="Untitled";try{if(t.kind==="brand"){const{data:a}=await o.from("brands").select("title").eq("id",t.target_id).single();s=(a==null?void 0:a.title)||"Untitled Brand"}else if(t.kind==="cv"){const{data:a}=await o.from("cvs").select("title").eq("id",t.target_id).single();s=(a==null?void 0:a.title)||"Untitled CV"}}catch{console.warn("Failed to fetch title for share:",t.id)}return{id:t.id,kind:t.kind,targetId:t.target_id,token:t.token,url:this.generateShareURL(t.token),createdAt:new Date(t.created_at),expiresAt:t.expires_at?new Date(t.expires_at):void 0,title:s}}))}catch(e){throw console.error("Error fetching user shares:",e),e}}static async deleteShare(e){try{const{error:r}=await o.from("shares").delete().eq("id",e);if(r)throw r}catch(r){throw console.error("Error deleting share:",r),r}}static async updateShareExpiration(e,r){try{const{error:i}=await o.from("shares").update({expires_at:r==null?void 0:r.toISOString()}).eq("id",e);if(i)throw i}catch(i){throw console.error("Error updating share expiration:",i),i}}static isShareValid(e){return e.expiresAt?e.expiresAt>new Date:!0}static generateToken(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}static async createShare(e,r,i){var n;try{const{data:t}=await o.auth.getUser();if(!t.user)throw new Error("User not authenticated");const s=this.generateToken(),{data:a,error:d}=await o.from("shares").insert({user_id:t.user.id,kind:e,target_id:r,token:s,expires_at:(n=i.expiresAt)==null?void 0:n.toISOString()}).select().single();if(d)throw d;return{id:a.id,token:a.token,url:this.generateShareURL(a.token),expiresAt:a.expires_at?new Date(a.expires_at):void 0}}catch(t){throw console.error("Error creating share:",t),t}}static generateShareURL(e){return`${this.BASE_URL}/share/${e}`}static mapBrandToBrandRider(e){return{title:e.title||"Untitled Brand",tagline:e.tagline||"",voiceTone:e.tone_notes?[e.tone_notes]:[],signaturePhrases:e.signature_phrases||[],strengths:e.strengths||[],weaknesses:e.weaknesses||[],palette:e.color_palette||[],fonts:e.fonts||{heading:"Arial",body:"Arial"},bio:e.bio||"",examples:e.examples||[],format:e.format_preset||"professional"}}static mapCVToCV(e){return{name:e.title||"Untitled CV",role:"Professional",summary:e.summary||"",experience:e.experience||[],skills:e.skills||[],links:e.links||[],format:e.format_preset||"professional"}}static getExpirationPresets(){const e=new Date;return[{label:"Never",value:null,description:"Link never expires"},{label:"1 Hour",value:new Date(e.getTime()+60*60*1e3),description:"Expires in 1 hour"},{label:"1 Day",value:new Date(e.getTime()+24*60*60*1e3),description:"Expires in 24 hours"},{label:"1 Week",value:new Date(e.getTime()+7*24*60*60*1e3),description:"Expires in 1 week"},{label:"1 Month",value:new Date(e.getTime()+30*24*60*60*1e3),description:"Expires in 1 month"},{label:"3 Months",value:new Date(e.getTime()+90*24*60*60*1e3),description:"Expires in 3 months"}]}}c(u,"BASE_URL",window.location.origin);export{u as S};
