import{j as e,c as Ls,E as We,b as zs,O as Os,u as Xe,W as qs,C as Gs,e as Qs,T as Hs,D as Ks,a as Ie,P as Ys,G as Ws,R as Xs}from"./ui-vendor-C0wu6Ixu.js";import{r as v}from"./react-vendor-CaWBk0BP.js";import{c as me,s as N,d as G,a as D,X as Is}from"./index-DuW-Yr95.js";import{B as C,b as Je}from"./button-D0nBzFIi.js";import{u as be,b as Js}from"./router-vendor-CjcZkGkV.js";import{T as Ze,a as es,b as O,c as q}from"./tabs-B0MGJ9wM.js";import{C as E,a as M,c as $,b as R}from"./card-CwGfeh1M.js";import{I as Ce}from"./input-CJw-rrwE.js";import{B as S}from"./badge-DIdVrDCd.js";import{S as Zs}from"./separator-dSadwi7O.js";import{u as Z}from"./query-vendor-Dx0-x9wB.js";import{F as K}from"./file-text-_TkRN8CW.js";import{I as ee}from"./id-card-Dh26hjtR.js";import{U as ue}from"./upload-DcScQ5z3.js";import{S as ss}from"./search-BYOnwMcq.js";import{P as ne}from"./plus-dhlbengw.js";import{A as as,D as _e,a as ke,b as De,c as Se,d as Ae,E as ea,s as He,i as sa,f as xe,H as aa,F as ts,e as rs}from"./dropdown-menu-DQYxht6M.js";import{T as ce,C as Te}from"./trending-up-BvzPOC0P.js";import{E as B}from"./eye-CqaP1oTC.js";import{f as he,C as ls}from"./checkbox-Bdf6tCxa.js";import{C as ta,S as fe,a as je,b as ve,c as we,d as W}from"./select-CGs7PUO_.js";import{C as oe,T as Pe,S as de}from"./trash-2-1wmQz1m8.js";import{D as V}from"./download-0BoksETV.js";import{P as ra}from"./progress-CPXDk6Q-.js";import{U as la}from"./users-C6gUJ-Ql.js";import{D as ia,f as na,a as ca,b as oa,c as da,d as ma,e as ua}from"./dialog-CiVULkyW.js";import{S as Ne}from"./star-uLuArE-J.js";import{a as Ke}from"./export-features-Bjk4ojhA.js";import{S as re}from"./share-manager-cWikJpsp.js";import"./label-B9gvsU_t.js";import"./avatar-Bj6B2ZKn.js";import{G as ha}from"./globe-D3hBw82x.js";import{L as xa}from"./lock-BoiZjYnG.js";import{C as pa}from"./calendar-ZbfWttRB.js";import{S as ga}from"./shield-C4PGmscN.js";import{U as fa}from"./user-BezrhGKr.js";import{L as ja}from"./log-out-CFclsIvA.js";import"./supabase-vendor-ChaIFbZk.js";import"./check-Dr51VA5y.js";import"./circle--ZRvplrL.js";import"./index-CS5Pkq6r.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=me("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=me("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=me("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=me("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);function Ee(s){const a=Z({queryKey:["dashboard-brands",s],queryFn:async()=>{if(!s)return[];const{data:o,error:d}=await N.from("brands").select("id, title, tagline, format_preset, created_at, updated_at, logo_url, visibility").eq("user_id",s).order("updated_at",{ascending:!1});if(d)throw d;return o||[]},enabled:!!s}),t=Z({queryKey:["dashboard-cvs",s],queryFn:async()=>{if(!s)return[];const{data:o,error:d}=await N.from("cvs").select("id, title, summary, format_preset, created_at, updated_at, visibility").eq("user_id",s).order("updated_at",{ascending:!1});if(d)throw d;return o||[]},enabled:!!s}),l=Z({queryKey:["dashboard-uploads",s],queryFn:async()=>{if(!s)return[];const{data:o,error:d}=await N.from("uploads").select("id, original_name, mime_type, size_bytes, created_at, visibility").eq("user_id",s).order("created_at",{ascending:!1});if(d)throw d;return o||[]},enabled:!!s}),i=Z({queryKey:["dashboard-stats",s],queryFn:async()=>{if(!s)return{totalBrands:0,totalCVs:0,totalUploads:0,recentActivity:[]};const o=a.data||[],d=t.data||[],f=l.data||[],h=[...o.map(m=>({id:m.id,type:"brand",title:m.title||"Untitled Brand",action:"updated",timestamp:m.updated_at||m.created_at||""})),...d.map(m=>({id:m.id,type:"cv",title:m.title||"Untitled CV",action:"updated",timestamp:m.updated_at||m.created_at||""})),...f.map(m=>({id:m.id,type:"upload",title:m.original_name,action:"created",timestamp:m.created_at||""}))].sort((m,x)=>new Date(x.timestamp).getTime()-new Date(m.timestamp).getTime()).slice(0,10);return{totalBrands:o.length,totalCVs:d.length,totalUploads:f.length,recentActivity:h}},enabled:!!s&&!a.isLoading&&!t.isLoading&&!l.isLoading});return{brands:a.data||[],cvs:t.data||[],uploads:l.data||[],stats:i.data,isLoading:a.isLoading||t.isLoading||l.isLoading,error:a.error||t.error||l.error,refetch:()=>{a.refetch(),t.refetch(),l.refetch(),i.refetch()}}}function Na(s,a=""){return Z({queryKey:["searchable-content",s,a],queryFn:async()=>{if(!s)return{brands:[],cvs:[],uploads:[]};const t=a.toLowerCase(),[l,i,o]=await Promise.all([N.from("brands").select("id, title, tagline, format_preset, created_at, updated_at, logo_url, visibility").eq("user_id",s).order("updated_at",{ascending:!1}),N.from("cvs").select("id, title, summary, format_preset, created_at, updated_at, visibility").eq("user_id",s).order("updated_at",{ascending:!1}),N.from("uploads").select("id, original_name, mime_type, size_bytes, created_at, visibility").eq("user_id",s).order("created_at",{ascending:!1})]);if(l.error)throw l.error;if(i.error)throw i.error;if(o.error)throw o.error;const d=l.data||[],f=i.data||[],h=o.data||[];return t?{brands:d.filter(m=>{var x,b,k;return((x=m.title)==null?void 0:x.toLowerCase().includes(t))||((b=m.tagline)==null?void 0:b.toLowerCase().includes(t))||((k=m.format_preset)==null?void 0:k.toLowerCase().includes(t))}),cvs:f.filter(m=>{var x,b,k;return((x=m.title)==null?void 0:x.toLowerCase().includes(t))||((b=m.summary)==null?void 0:b.toLowerCase().includes(t))||((k=m.format_preset)==null?void 0:k.toLowerCase().includes(t))}),uploads:h.filter(m=>{var x;return m.original_name.toLowerCase().includes(t)||((x=m.mime_type)==null?void 0:x.toLowerCase().includes(t))})}:{brands:d,cvs:f,uploads:h}},enabled:!!s})}function ya({userId:s}){const[a,t]=v.useState(""),l=be(),{stats:i,isLoading:o}=Ee(s),{data:d}=Na(s,a);return o?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map((f,h)=>e.jsxs(E,{className:"animate-pulse",children:[e.jsx(M,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})}),e.jsxs($,{children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/3 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},h))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(pe,{title:"Brand Riders",value:(i==null?void 0:i.totalBrands)||0,icon:e.jsx(K,{className:"w-5 h-5"}),description:"Professional brand documents",onClick:()=>l("/dashboard?tab=brands")}),e.jsx(pe,{title:"CVs",value:(i==null?void 0:i.totalCVs)||0,icon:e.jsx(ee,{className:"w-5 h-5"}),description:"Generated resumes",onClick:()=>l("/dashboard?tab=cvs")}),e.jsx(pe,{title:"Uploads",value:(i==null?void 0:i.totalUploads)||0,icon:e.jsx(ue,{className:"w-5 h-5"}),description:"Source documents",onClick:()=>l("/dashboard?tab=uploads")})]}),e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-5 h-5"}),"Search Your Content"]})}),e.jsxs($,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ce,{placeholder:"Search brands, CVs, and uploads...",value:a,onChange:f=>t(f.target.value),className:"flex-1"}),e.jsxs(C,{variant:"outline",onClick:()=>l("/create"),className:"gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Create New"]})]}),a&&d&&e.jsx("div",{className:"mt-4 space-y-4",children:e.jsx(ba,{brands:d.brands,cvs:d.cvs,uploads:d.uploads,onNavigate:l})})]})]}),(i==null?void 0:i.recentActivity)&&i.recentActivity.length>0&&e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5"}),"Recent Activity"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3",children:i.recentActivity.map((f,h)=>e.jsxs("div",{children:[e.jsx(Ca,{activity:f,onNavigate:l}),h<i.recentActivity.length-1&&e.jsx(Zs,{className:"mt-3"})]},f.id))})})]}),e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(R,{children:"Quick Actions"})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(le,{icon:e.jsx(ne,{className:"w-5 h-5"}),title:"Create Brand",description:"Start new brand rider",onClick:()=>l("/create")}),e.jsx(le,{icon:e.jsx(K,{className:"w-5 h-5"}),title:"View Brands",description:"Manage your brands",onClick:()=>l("/dashboard?tab=brands")}),e.jsx(le,{icon:e.jsx(ee,{className:"w-5 h-5"}),title:"View CVs",description:"Manage your CVs",onClick:()=>l("/dashboard?tab=cvs")}),e.jsx(le,{icon:e.jsx(ce,{className:"w-5 h-5"}),title:"Gallery",description:"Browse community",onClick:()=>l("/gallery")})]})})]})]})}function pe({title:s,value:a,icon:t,description:l,onClick:i}){return e.jsxs(E,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:i,children:[e.jsxs(M,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:s}),t]}),e.jsxs($,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l})]})]})}function ba({brands:s,cvs:a,uploads:t,onNavigate:l}){return s.length>0||a.length>0||t.length>0?e.jsxs("div",{className:"space-y-4",children:[s.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Brand Riders (",s.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.slice(0,3).map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>l(`/brand/${o.id}`),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.title||"Untitled Brand"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o.tagline})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.format_preset&&e.jsx(S,{variant:"secondary",children:o.format_preset}),e.jsx(C,{variant:"ghost",size:"sm",children:e.jsx(B,{className:"w-4 h-4"})})]})]},o.id))})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"CVs (",a.length,")"]}),e.jsx("div",{className:"space-y-2",children:a.slice(0,3).map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>l(`/cv/${o.id}`),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.title||"Untitled CV"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o.summary})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o.format_preset&&e.jsx(S,{variant:"secondary",children:o.format_preset}),e.jsx(C,{variant:"ghost",size:"sm",children:e.jsx(B,{className:"w-4 h-4"})})]})]},o.id))})]}),t.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Uploads (",t.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.slice(0,3).map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.original_name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.mime_type," • ",_a(o.size_bytes)]})]}),e.jsx(S,{variant:"outline",children:he(new Date(o.created_at),{addSuffix:!0})})]},o.id))})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No results found for your search."})}function Ca({activity:s,onNavigate:a}){const t=()=>{switch(s.type){case"brand":return e.jsx(K,{className:"w-4 h-4"});case"cv":return e.jsx(ee,{className:"w-4 h-4"});case"upload":return e.jsx(ue,{className:"w-4 h-4"})}},l=()=>{switch(s.type){case"brand":return`/brand/${s.id}`;case"cv":return`/cv/${s.id}`;case"upload":return"/dashboard?tab=uploads"}};return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-muted rounded-lg",children:t()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.action==="created"?"Created":"Updated"," ",he(new Date(s.timestamp),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",className:"capitalize",children:s.type}),s.type!=="upload"&&e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>a(l()),children:e.jsx(B,{className:"w-4 h-4"})})]})]})}function le({icon:s,title:a,description:t,onClick:l}){return e.jsxs(C,{variant:"outline",className:"h-auto p-4 flex flex-col items-start gap-2 hover:bg-muted/50",onClick:l,children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[s,e.jsx("span",{className:"font-medium",children:a})]}),e.jsx("span",{className:"text-xs text-muted-foreground text-left",children:t})]})}function _a(s){if(!s)return"0 B";const a=["B","KB","MB","GB"],t=Math.floor(Math.log(s)/Math.log(1024));return`${(s/Math.pow(1024,t)).toFixed(1)} ${a[t]}`}var ns="AlertDialog",[ka,Rt]=Ls(ns,[We]),L=We(),cs=s=>{const{__scopeAlertDialog:a,...t}=s,l=L(a);return e.jsx(Xs,{...l,...t,modal:!0})};cs.displayName=ns;var Da="AlertDialogTrigger",Sa=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=L(t);return e.jsx(zs,{...i,...l,ref:a})});Sa.displayName=Da;var Aa="AlertDialogPortal",os=s=>{const{__scopeAlertDialog:a,...t}=s,l=L(a);return e.jsx(Ys,{...l,...t})};os.displayName=Aa;var Ta="AlertDialogOverlay",ds=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=L(t);return e.jsx(Os,{...i,...l,ref:a})});ds.displayName=Ta;var X="AlertDialogContent",[Pa,Ea]=ka(X),$a=Ws("AlertDialogContent"),ms=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,children:l,...i}=s,o=L(t),d=v.useRef(null),f=Xe(a,d),h=v.useRef(null);return e.jsx(qs,{contentName:X,titleName:us,docsSlug:"alert-dialog",children:e.jsx(Pa,{scope:t,cancelRef:h,children:e.jsxs(Gs,{role:"alertdialog",...o,...i,ref:f,onOpenAutoFocus:Qs(i.onOpenAutoFocus,m=>{var x;m.preventDefault(),(x=h.current)==null||x.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[e.jsx($a,{children:l}),e.jsx(Ma,{contentRef:d})]})})})});ms.displayName=X;var us="AlertDialogTitle",hs=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=L(t);return e.jsx(Hs,{...i,...l,ref:a})});hs.displayName=us;var xs="AlertDialogDescription",ps=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=L(t);return e.jsx(Ks,{...i,...l,ref:a})});ps.displayName=xs;var Fa="AlertDialogAction",gs=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=L(t);return e.jsx(Ie,{...i,...l,ref:a})});gs.displayName=Fa;var fs="AlertDialogCancel",js=v.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,{cancelRef:i}=Ea(fs,t),o=L(t),d=Xe(a,i);return e.jsx(Ie,{...o,...l,ref:d})});js.displayName=fs;var Ma=({contentRef:s})=>{const a=`\`${X}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${X}\` by passing a \`${xs}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${X}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return v.useEffect(()=>{var l;document.getElementById((l=s.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(a)},[a,s]),null},Ua=cs,Ra=os,vs=ds,ws=ms,Ns=gs,ys=js,bs=hs,Cs=ps;const _s=Ua,Ba=Ra,ks=v.forwardRef(({className:s,...a},t)=>e.jsx(vs,{className:G("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));ks.displayName=vs.displayName;const $e=v.forwardRef(({className:s,...a},t)=>e.jsxs(Ba,{children:[e.jsx(ks,{}),e.jsx(ws,{ref:t,className:G("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));$e.displayName=ws.displayName;const Fe=({className:s,...a})=>e.jsx("div",{className:G("flex flex-col space-y-2 text-center sm:text-left",s),...a});Fe.displayName="AlertDialogHeader";const Me=({className:s,...a})=>e.jsx("div",{className:G("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Me.displayName="AlertDialogFooter";const Ue=v.forwardRef(({className:s,...a},t)=>e.jsx(bs,{ref:t,className:G("text-lg font-semibold",s),...a}));Ue.displayName=bs.displayName;const Re=v.forwardRef(({className:s,...a},t)=>e.jsx(Cs,{ref:t,className:G("text-sm text-muted-foreground",s),...a}));Re.displayName=Cs.displayName;const Be=v.forwardRef(({className:s,...a},t)=>e.jsx(Ns,{ref:t,className:G(Je(),s),...a}));Be.displayName=Ns.displayName;const Ve=v.forwardRef(({className:s,...a},t)=>e.jsx(ys,{ref:t,className:G(Je({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));Ve.displayName=ys.displayName;function Va({selectedItems:s,totalItems:a,contentType:t,onSelectAll:l,onClearSelection:i,onBulkAction:o}){const[d,f]=v.useState(!1),[h,m]=v.useState(!1),x=s.length===a&&a>0;s.length>0&&s.length<a;const b=async p=>{if(s.length!==0){if(p==="delete"){f(!0);return}m(!0);try{await o(p,s);const j={duplicate:"duplicated",export:"exported",share:"shared",archive:"archived",makePublic:"made public",makePrivate:"made private",addTag:"tagged"};D.success(`${s.length} ${t} ${j[p]||"processed"} successfully`),i()}catch{D.error(`Failed to process ${t}. Please try again.`)}finally{m(!1)}}},k=async()=>{m(!0);try{await o("delete",s),D.success(`${s.length} ${t} deleted successfully`),i()}catch{D.error(`Failed to delete ${t}. Please try again.`)}finally{m(!1),f(!1)}},c=()=>{const p=[{key:"duplicate",label:"Duplicate",icon:oe,destructive:!1},{key:"export",label:"Export All",icon:V,destructive:!1}];return t!=="uploads"&&p.push({key:"share",label:"Share All",icon:se,destructive:!1},{key:"makePublic",label:"Make Public",icon:B,destructive:!1},{key:"makePrivate",label:"Make Private",icon:ea,destructive:!1},{key:"addTag",label:"Add Tag",icon:wa,destructive:!1}),p.push({key:"archive",label:"Archive",icon:va,destructive:!1},{key:"delete",label:"Delete",icon:Pe,destructive:!0}),p};return a===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{checked:x,onCheckedChange:p=>l(!!p)}),e.jsx("span",{className:"text-sm font-medium",children:s.length>0?e.jsxs(e.Fragment,{children:[s.length," of ",a," selected"]}):`Select all ${a} ${t}`})]}),s.length>0&&e.jsxs(S,{variant:"secondary",children:[s.length," selected"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outline",size:"sm",onClick:i,disabled:h,children:"Clear Selection"}),e.jsxs(_e,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",disabled:h,className:"gap-2",children:["Bulk Actions",e.jsx(ta,{className:"w-4 h-4"})]})}),e.jsx(De,{align:"end",children:c().map((p,j)=>e.jsxs("div",{children:[p.destructive&&j>0&&e.jsx(Se,{}),e.jsxs(Ae,{onClick:()=>b(p.key),className:p.destructive?"text-destructive":"",disabled:h,children:[e.jsx(p.icon,{className:"w-4 h-4 mr-2"}),p.label]})]},p.key))})]})]})})]}),e.jsx(_s,{open:d,onOpenChange:f,children:e.jsxs($e,{children:[e.jsxs(Fe,{children:[e.jsxs(Ue,{children:["Delete ",s.length," ",t,"?"]}),e.jsxs(Re,{children:["This action cannot be undone. This will permanently delete the selected ",t," and remove them from our servers."]})]}),e.jsxs(Me,{children:[e.jsx(Ve,{disabled:h,children:"Cancel"}),e.jsx(Be,{onClick:k,disabled:h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:h?"Deleting...":"Delete"})]})]})})]})}function La({contentType:s,items:a}){const t=za(a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ie,{title:"Total Views",value:t.totalViews,icon:e.jsx(B,{className:"w-4 h-4"}),trend:"+12%",trendUp:!0}),e.jsx(ie,{title:"Shares",value:t.totalShares,icon:e.jsx(se,{className:"w-4 h-4"}),trend:"+8%",trendUp:!0}),e.jsx(ie,{title:"Downloads",value:t.totalDownloads,icon:e.jsx(V,{className:"w-4 h-4"}),trend:"+15%",trendUp:!0}),e.jsx(ie,{title:"Recent Activity",value:t.recentActivity,icon:e.jsx(as,{className:"w-4 h-4"}),trend:"Last 7 days",trendUp:null})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s!=="uploads"&&t.popularFormats.length>0&&e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-5 h-5"}),"Format Distribution"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-4",children:t.popularFormats.map(l=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium capitalize",children:l.format}),e.jsxs("span",{className:"text-muted-foreground",children:[l.count," (",l.percentage,"%)"]})]}),e.jsx(ra,{value:l.percentage,className:"h-2"})]},l.format))})})]}),s!=="uploads"&&e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(la,{className:"w-5 h-5"}),"Visibility Settings"]})}),e.jsx($,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{children:"Public"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t.visibilityStats.public}),e.jsxs(S,{variant:"outline",children:[Math.round(t.visibilityStats.public/a.length*100),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded-full"}),e.jsx("span",{children:"Private"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t.visibilityStats.private}),e.jsxs(S,{variant:"outline",children:[Math.round(t.visibilityStats.private/a.length*100),"%"]})]})]})]})})]}),e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Creation Trend"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3",children:t.creationTrend.map((l,i)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:l.period}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${Math.min(l.count/Math.max(...t.creationTrend.map(o=>o.count))*100,100)}%`}})}),e.jsx("span",{className:"font-medium w-6 text-right",children:l.count})]})]},i))})})]}),t.topPerforming.length>0&&e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),"Top Performing"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3",children:t.topPerforming.slice(0,5).map((l,i)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-muted rounded-full text-xs font-medium",children:i+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:Oa(l,s)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:he(new Date(l.created_at),{addSuffix:!0})})]}),e.jsx(S,{variant:"secondary",className:"text-xs",children:l.format_preset||"Default"})]},l.id))})})]})]})]})}function ie({title:s,value:a,icon:t,trend:l,trendUp:i}){return e.jsx(E,{children:e.jsxs($,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("p",{className:"text-2xl font-bold",children:a.toLocaleString()})]}),e.jsx("div",{className:"p-2 bg-muted rounded-lg",children:t})]}),e.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[i!==null&&e.jsx(ce,{className:`w-4 h-4 mr-1 ${i?"text-green-600":"text-red-600 rotate-180"}`}),e.jsx("span",{className:i!==null?i?"text-green-600":"text-red-600":"text-muted-foreground",children:l})]})]})})}function za(s,a){const t=new Date,l=He(t,7),i=s.length*Math.floor(Math.random()*50)+10,o=Math.floor(i*.1),d=Math.floor(i*.15),f=s.filter(c=>sa(new Date(c.updated_at||c.created_at),l)).length,h={};s.forEach(c=>{const p=c.format_preset||"default";h[p]=(h[p]||0)+1});const m=Object.entries(h).map(([c,p])=>({format:c,count:p,percentage:Math.round(p/s.length*100)})).sort((c,p)=>p.count-c.count),x={public:s.filter(c=>c.visibility==="public").length,private:s.filter(c=>c.visibility==="private"||!c.visibility).length},b=[];for(let c=6;c>=0;c--){const p=He(t,c),j=s.filter(g=>{const _=new Date(g.created_at);return xe(_,"yyyy-MM-dd")===xe(p,"yyyy-MM-dd")});b.push({period:c===0?"Today":c===1?"Yesterday":xe(p,"MMM dd"),count:j.length})}const k=[...s].sort((c,p)=>new Date(p.updated_at||p.created_at).getTime()-new Date(c.updated_at||c.created_at).getTime()).slice(0,5);return{totalViews:i,totalShares:o,totalDownloads:d,recentActivity:f,popularFormats:m,visibilityStats:x,creationTrend:b,topPerforming:k}}function Oa(s,a){return a==="uploads"?s.original_name:s.title||`Untitled ${a.slice(0,-1)}`}function qa({contentType:s,items:a,onTagsUpdate:t,onFavoriteToggle:l}){const[i,o]=v.useState([]),[d,f]=v.useState([]),[h,m]=v.useState("all"),[x,b]=v.useState(!1);v.useEffect(()=>{k()},[a]);const k=()=>{const g={},_=new Set;a.forEach(T=>{(T.tags??[]).forEach(Q=>{_.add(Q),g[Q]=(g[Q]||0)+1})}),o(Array.from(_));const U=Array.from(_).map(T=>({tag:T,count:g[T],color:c(T)})).sort((T,z)=>z.count-T.count);f(U)},c=g=>{const _=["bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400","bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400","bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400","bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400","bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400"],U=g.split("").reduce((T,z)=>T+z.charCodeAt(0),0);return _[U%_.length]},p=a.filter(g=>{const _=h==="all"||(g.tags||[]).includes(h),U=!x||g.is_favorite;return _&&U}),j=a.filter(g=>!!g.is_favorite);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E,{children:[e.jsx(M,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"w-5 h-5"}),"Tags & Organization"]})}),e.jsx($,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"font-medium",children:"Favorites"}),e.jsx(S,{variant:"secondary",children:j.length})]}),e.jsxs(C,{variant:x?"default":"outline",size:"sm",onClick:()=>b(!x),className:"gap-2",children:[x?e.jsx(Ne,{className:"w-4 h-4"}):e.jsx(is,{className:"w-4 h-4"}),x?"Show All":"Favorites Only"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filter by tag:"})]}),e.jsxs(fe,{value:h,onValueChange:m,children:[e.jsx(je,{className:"w-[200px]",children:e.jsx(ve,{})}),e.jsxs(we,{children:[e.jsx(W,{value:"all",children:"All Tags"}),d.map(g=>e.jsxs(W,{value:g.tag,children:[g.tag," (",g.count,")"]},g.tag))]})]})]}),d.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Popular Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.slice(0,10).map(g=>e.jsxs(S,{variant:"secondary",className:`cursor-pointer ${g.color}`,onClick:()=>m(g.tag),children:[g.tag," (",g.count,")"]},g.tag))})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[h==="all"?"All Items":`Tagged: ${h}`,x&&" (Favorites)"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[p.length," ",s]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p.map(g=>e.jsx(Ga,{item:g,contentType:s,allTags:i,onTagsUpdate:t,onFavoriteToggle:l,getTagColor:c},g.id))}),p.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No ",s," found with the selected filters."]})]})]})}function Ga({item:s,contentType:a,allTags:t,onTagsUpdate:l,onFavoriteToggle:i,getTagColor:o}){const[d,f]=v.useState(!1),[h,m]=v.useState(""),[x,b]=v.useState(s.tags??[]),k=async()=>{if(!h.trim()||x.includes(h.trim()))return;const j=[...x,h.trim()];b(j),m("");try{await l(s.id,j)}catch(g){b(x),g!=null&&g.handled||D.error("Failed to add tag")}},c=async j=>{const g=x.filter(_=>_!==j);b(g);try{await l(s.id,g)}catch(_){b(x),_!=null&&_.handled||D.error("Failed to remove tag")}},p=async()=>{try{await i(s.id,!s.is_favorite)}catch(j){j!=null&&j.handled||D.error("Failed to update favorite status")}};return e.jsxs(E,{className:"group hover:shadow-md transition-shadow",children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium truncate",children:s.title||`Untitled ${a.slice(0,-1)}`}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"tagline"in s?s.tagline:s.summary})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:p,className:"opacity-0 group-hover:opacity-100 transition-opacity",children:s.is_favorite?e.jsx(Ne,{className:"w-4 h-4 text-yellow-500 fill-current"}):e.jsx(is,{className:"w-4 h-4"})})]})}),e.jsx($,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:x.map(j=>e.jsxs(S,{variant:"secondary",className:`text-xs ${o(j)} group/tag`,children:[j,e.jsx(C,{variant:"ghost",size:"sm",className:"ml-1 h-auto p-0 opacity-0 group-hover/tag:opacity-100 transition-opacity",onClick:()=>c(j),children:e.jsx(Is,{className:"w-3 h-3"})})]},j))}),e.jsxs(ia,{open:d,onOpenChange:f,children:[e.jsx(na,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"w-full gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(ne,{className:"w-4 h-4"}),"Add Tag"]})}),e.jsxs(ca,{children:[e.jsxs(oa,{children:[e.jsx(da,{children:"Add Tags"}),e.jsxs(ma,{children:["Add tags to organize your ",a.slice(0,-1),"."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ce,{placeholder:"Enter tag name...",value:h,onChange:j=>m(j.target.value),onKeyDown:j=>{j.key==="Enter"&&(j.preventDefault(),k())}}),e.jsx(C,{onClick:k,disabled:!h.trim(),children:"Add"})]}),t.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Or select from existing tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.filter(j=>!x.includes(j)).slice(0,10).map(j=>e.jsx(S,{variant:"outline",className:"cursor-pointer hover:bg-muted",onClick:()=>{m(j),k()},children:j},j))})]})]}),e.jsx(ua,{children:e.jsx(C,{variant:"outline",onClick:()=>f(!1),children:"Done"})})]})]})]})})]})}const ae=s=>"storage_path"in s,ye=s=>"tagline"in s,Ds=s=>"summary"in s&&!("storage_path"in s);function ge({type:s,items:a,onRefresh:t}){const[l,i]=v.useState(""),[o,d]=v.useState("updated_at"),[f,h]=v.useState("all"),[m,x]=v.useState([]),[b,k]=v.useState("grid"),c=be(),p=a.filter(r=>{var P,y,F,A;const n=l.toLowerCase(),u=((P=r.title)==null?void 0:P.toLowerCase().includes(n))||((y=r.original_name)==null?void 0:y.toLowerCase().includes(n))||((F=r.tagline)==null?void 0:F.toLowerCase().includes(n))||((A=r.summary)==null?void 0:A.toLowerCase().includes(n)),w=f==="all"||r.visibility===f||r.format_preset===f;return u&&w}).sort((r,n)=>{const u=r[o]||r.created_at,w=n[o]||n.created_at;return new Date(w).getTime()-new Date(u).getTime()}),j=()=>{const r=[{value:"all",label:"All Items"}];if(s!=="uploads"){const n=a.filter(w=>!ae(w));r.push({value:"public",label:"Public"},{value:"private",label:"Private"}),[...new Set(n.map(w=>w.format_preset).filter(Boolean))].forEach(w=>{r.push({value:w,label:w.toUpperCase()})})}return r},g=v.useMemo(()=>{switch(s){case"brands":return"brands";case"cvs":return"cvs";default:return"uploads"}},[s]),_=(r,n)=>{const u=r instanceof Error&&r.message?r.message:n;console.error(n,r),D.error(u);const w=r instanceof Error?r:new Error(u||n);return w.handled=!0,w},U=(r,n)=>{const u=document.createElement("a");u.href=r,u.download=n,document.body.appendChild(u),u.click(),document.body.removeChild(u)},T=r=>"tags"in r&&Array.isArray(r.tags)?r.tags??[]:[],z=r=>({title:r.title||"Untitled Brand",tagline:r.tagline||"",voiceTone:r.tone_notes?[r.tone_notes]:[],signaturePhrases:r.signature_phrases||[],strengths:r.strengths||[],weaknesses:r.weaknesses||[],palette:r.color_palette||[],fonts:r.fonts||{heading:"Arial",body:"Arial"},bio:r.bio||"",examples:r.examples||[],format:r.format_preset||"professional"}),Q=r=>({name:r.title||"Untitled CV",role:"Professional",summary:r.summary||"",experience:r.experience||[],skills:r.skills||[],links:r.links||[],format:r.format_preset||"professional"}),Le=async r=>{var I;const n=r.storage_path,u=r.original_name.split("."),w=u.length>1?`.${u.pop()}`:"",y=`${u.join(".")||"file"}-copy${w}`,F=`${r.user_id}/${((I=crypto.randomUUID)==null?void 0:I.call(crypto))||Date.now()}-${y}`,{error:A}=await N.storage.from("uploads").copy(n,F);if(A)throw A;const{error:Y}=await N.from("uploads").insert({user_id:r.user_id,storage_path:F,original_name:y,mime_type:r.mime_type,size_bytes:r.size_bytes,extracted_text:r.extracted_text,visibility:r.visibility});if(Y)throw Y},ze=async r=>{if(s==="uploads"){const{data:H,error:J}=await N.from("uploads").select("*").eq("id",r).single();if(J||!H)throw J||new Error("Upload not found");await Le(H);return}if(s==="brands"){const{data:H,error:J}=await N.from("brands").select("*").eq("id",r).single();if(J||!H)throw J||new Error("Brand not found");const Ge=new Date().toISOString(),{id:Ka,created_at:Ya,updated_at:Wa,...Bs}=H,Vs={...Bs,title:H.title?`${H.title} (Copy)`:"Untitled brand Copy",created_at:Ge,updated_at:Ge},{error:Qe}=await N.from("brands").insert(Vs);if(Qe)throw Qe;return}const{data:n,error:u}=await N.from("cvs").select("*").eq("id",r).single();if(u||!n)throw u||new Error("CV not found");const w=new Date().toISOString(),{id:P,created_at:y,updated_at:F,...A}=n,Y={...A,title:n.title?`${n.title} (Copy)`:"Untitled cv Copy",created_at:w,updated_at:w},{error:I}=await N.from("cvs").insert(Y);if(I)throw I},As=async r=>{const{error:n}=await N.storage.from("uploads").remove([r.storage_path]);if(n)throw n},Oe=async r=>{s==="uploads"&&await As(r);const{error:n}=await N.from(g).delete().eq("id",r.id);if(n)throw n},Ts=async r=>{var u;if(s==="uploads")throw new Error("Sharing is not supported for uploads");const n=s==="brands"?await re.shareBrandRider(r):await re.shareCV(r);try{await navigator.clipboard.writeText(n.url),D.success("Share link copied to clipboard")}catch(w){console.warn("Clipboard write failed, falling back to prompt",w),(u=window.prompt)==null||u.call(window,"Share link (copy manually):",n.url),D.success("Share link ready")}},Ps=async r=>{const{data:n,error:u}=await N.storage.from("uploads").download(r.storage_path);if(u||!n)throw u||new Error("Unable to download file");const w=URL.createObjectURL(n);U(w,r.original_name),URL.revokeObjectURL(w)},Es=async r=>{const{data:n,error:u}=await N.from("brands").select("*").eq("id",r).single();if(u||!n)throw u||new Error("Brand not found");const w=z(n),{url:P,filename:y}=await Ke.exportBrandRider(w,{filename:`${n.title||"brand"}-rider.pdf`});U(P,y),setTimeout(()=>URL.revokeObjectURL(P),0)},$s=async r=>{const{data:n,error:u}=await N.from("cvs").select("*").eq("id",r).single();if(u||!n)throw u||new Error("CV not found");const w=Q(n),{url:P,filename:y}=await Ke.exportCV(w,{filename:`${n.title||"cv"}.pdf`});U(P,y),setTimeout(()=>URL.revokeObjectURL(P),0)},te=async(r,n)=>{switch(r){case"view":s==="brands"?c(`/brand/${n.id}`):s==="cvs"&&c(`/cv/${n.id}`);break;case"edit":s==="brands"?c(`/brand/${n.id}/edit`):s==="cvs"&&c(`/cv/${n.id}/edit`);break;case"generateCV":s==="brands"&&(console.log("Navigating to generate CV for brand:",n.id),c(`/brand/${n.id}/generate-cv`));break;case"duplicate":try{await ze(n.id),D.success(`${s.slice(0,-1)} duplicated successfully`),t()}catch(u){throw _(u,`Unable to duplicate ${s.slice(0,-1)}`)}return;case"delete":try{await Oe(n),D.success(`${s.slice(0,-1)} deleted successfully`),t()}catch(u){throw _(u,`Unable to delete ${s.slice(0,-1)}`)}return;case"share":try{await Ts(n.id)}catch(u){throw _(u,`Unable to share ${s.slice(0,-1)}`)}return;case"download":try{s==="uploads"?await Ps(n):s==="brands"?await Es(n.id):s==="cvs"&&await $s(n.id),D.success("Download started")}catch(u){throw _(u,`Unable to download ${s.slice(0,-1)}`)}return}},Fs=async(r,n)=>{var w,P;const u=a.filter(y=>n.includes(y.id));if(u.length!==0)try{switch(r){case"duplicate":for(const y of u)await ze(y.id);t();break;case"export":for(const y of u)await te("download",y);break;case"share":if(s==="uploads")throw new Error("Uploads cannot be shared");{const y=[];for(const A of u){const Y=s==="brands"?await re.shareBrandRider(A.id):await re.shareCV(A.id);y.push(Y.url)}const F=y.join(`
`);try{await navigator.clipboard.writeText(F),D.success("Share links copied to clipboard")}catch(A){console.warn("Failed to write share links to clipboard",A),(w=window.prompt)==null||w.call(window,"Share links (copy manually):",F),D.success("Share links ready")}}break;case"archive":if(s==="uploads")throw new Error("Archive is only available for generated content");await N.from(g).update({visibility:"archived"}).in("id",n),t();break;case"makePublic":if(s==="uploads")throw new Error("Visibility updates are not supported for uploads");await N.from(g).update({visibility:"public"}).in("id",n),t();break;case"makePrivate":if(s==="uploads")throw new Error("Visibility updates are not supported for uploads");await N.from(g).update({visibility:"private"}).in("id",n),t();break;case"addTag":if(s==="uploads")throw new Error("Tags are only supported for generated content");{const y=(P=window.prompt)==null?void 0:P.call(window,"Enter a tag to add to the selected items");if(!y)throw new Error("Tag entry cancelled");for(const F of u){const A=Array.from(new Set([...T(F),y]));await N.from(g).update({tags:A}).eq("id",F.id)}t()}break;case"delete":for(const y of u)await Oe(y);t();break;default:console.warn(`Unhandled bulk action: ${r}`)}}catch(y){throw y!=null&&y.handled?y:_(y,`Failed to process ${r} action`)}},Ms=async(r,n)=>{if(s==="uploads"){D.error("Tags are only available for generated content");return}try{const{error:u}=await N.from(g).update({tags:n}).eq("id",r);if(u)throw u;D.success("Tags updated successfully"),t()}catch(u){throw _(u,"Failed to update tags")}},Us=async(r,n)=>{if(s==="uploads"){D.error("Favorites are only available for generated content");return}try{const{error:u}=await N.from(g).update({is_favorite:n}).eq("id",r);if(u)throw u;D.success(n?"Added to favorites":"Removed from favorites"),t()}catch(u){throw _(u,"Failed to update favorite status")}},Rs=r=>{x(r?p.map(n=>n.id):[])},qe=(r,n)=>{x(n?u=>[...u,r]:u=>u.filter(w=>w!==r))};return e.jsx("div",{className:"space-y-6",children:e.jsxs(Ze,{value:b,onValueChange:k,children:[e.jsxs(es,{className:"grid w-full grid-cols-4",children:[e.jsx(O,{value:"grid",children:"Grid View"}),e.jsx(O,{value:"analytics",children:"Analytics"}),s!=="uploads"&&e.jsx(O,{value:"tags",children:"Tags"}),e.jsx(O,{value:"favorites",children:"Favorites"})]}),e.jsxs(q,{value:"grid",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ss,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ce,{placeholder:`Search ${s}...`,value:l,onChange:r=>i(r.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(fe,{value:o,onValueChange:d,children:[e.jsx(je,{className:"w-[140px]",children:e.jsx(ve,{})}),e.jsxs(we,{children:[e.jsx(W,{value:"updated_at",children:"Last Updated"}),e.jsx(W,{value:"created_at",children:"Date Created"}),e.jsx(W,{value:"title",children:"Name"})]})]}),e.jsxs(fe,{value:f,onValueChange:h,children:[e.jsxs(je,{className:"w-[120px]",children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),e.jsx(ve,{})]}),e.jsx(we,{children:j().map(r=>e.jsx(W,{value:r.value,children:r.label},r.value))})]})]})]}),m.length===1?e.jsx(Qa,{item:p.find(r=>r.id===m[0])??null,contentType:s,onAction:te,onClearSelection:()=>x([])}):e.jsx(Va,{selectedItems:m,totalItems:p.length,contentType:s,onSelectAll:Rs,onClearSelection:()=>x([]),onBulkAction:Fs}),p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-muted-foreground mb-4",children:l||f!=="all"?`No ${s} match your search criteria.`:`You haven't created any ${s} yet.`}),!l&&f==="all"&&e.jsxs(C,{onClick:()=>c("/create"),children:["Create Your First ",s.slice(0,-1)]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(r=>e.jsx(Ye,{type:s,item:r,isSelected:m.includes(r.id),onSelect:n=>qe(r.id,n),onAction:te},r.id))})]}),e.jsx(q,{value:"analytics",children:e.jsx(La,{contentType:s,items:a})}),s!=="uploads"&&e.jsx(q,{value:"tags",children:e.jsx(qa,{contentType:s,items:a,onTagsUpdate:Ms,onFavoriteToggle:Us})}),e.jsx(q,{value:"favorites",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Favorite ",s]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.filter(r=>!!r.is_favorite).map(r=>e.jsx(Ye,{type:s,item:r,isSelected:m.includes(r.id),onSelect:n=>qe(r.id,n),onAction:te},r.id))}),a.filter(r=>!!r.is_favorite).length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No favorite ",s," yet. Star items to add them to your favorites."]})]})})]})})}function Ye({type:s,item:a,isSelected:t=!1,onSelect:l,onAction:i}){const o=()=>ae(a)?a.original_name:a.title||`Untitled ${s.slice(0,-1)}`,d=()=>ae(a)?`${a.mime_type} • ${Ss(a.size_bytes)}`:ye(a)?a.tagline||"":Ds(a)&&a.summary||"",f=()=>{const h=[{key:"duplicate",label:"Duplicate",icon:oe,destructive:!1},{key:"delete",label:"Delete",icon:Pe,destructive:!0}];return s==="uploads"?[{key:"download",label:"Download",icon:V,destructive:!1},...h]:[{key:"view",label:"View",icon:B,destructive:!1},{key:"edit",label:"Edit",icon:de,destructive:!1},{key:"share",label:"Share",icon:se,destructive:!1},{key:"download",label:"Export PDF",icon:V,destructive:!1},...h]};return e.jsxs(E,{className:`group hover:shadow-md transition-shadow ${t?"ring-2 ring-primary":""}`,children:[e.jsx(M,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[l&&e.jsx(ls,{checked:t,onCheckedChange:l,className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(R,{className:"text-lg truncate",children:o()}),d()&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:d()})]})]}),e.jsxs(_e,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(rs,{className:"w-4 h-4"})})}),e.jsx(De,{align:"end",children:f().map((h,m)=>e.jsxs("div",{children:[m===f().length-2&&e.jsx(Se,{}),e.jsxs(Ae,{onClick:()=>i(h.key,a),className:h.destructive?"text-destructive":"",children:[e.jsx(h.icon,{className:"w-4 h-4 mr-2"}),h.label]})]},h.key))})]})]})}),e.jsxs($,{className:"pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:["format_preset"in a&&a.format_preset&&e.jsx(S,{variant:"secondary",className:"text-xs",children:a.format_preset.toUpperCase()}),"visibility"in a&&a.visibility&&e.jsx(S,{variant:"outline",className:"text-xs",children:a.visibility==="public"?e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-3 h-3 mr-1"}),"Public"]}):e.jsxs(e.Fragment,{children:[e.jsx(xa,{className:"w-3 h-3 mr-1"}),"Private"]})})]}),e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(pa,{className:"w-3 h-3 mr-1"}),he(new Date(a.updated_at||a.created_at),{addSuffix:!0})]})]}),s!=="uploads"&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{Promise.resolve(i("view",a)).catch(()=>{})},children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"View"]}),e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>{Promise.resolve(i("edit",a)).catch(()=>{})},children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Edit"]}),s==="brands"&&e.jsxs(C,{variant:"default",size:"sm",className:"flex-1",onClick:()=>{Promise.resolve(i("generateCV",a)).catch(()=>{})},children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"CV"]})]}),e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[e.jsxs(C,{variant:"ghost",size:"sm",className:"flex-1 text-xs",onClick:()=>{Promise.resolve(i("share",a)).catch(()=>{})},children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Share"]}),e.jsxs(C,{variant:"ghost",size:"sm",className:"flex-1 text-xs",onClick:()=>{Promise.resolve(i("duplicate",a)).catch(()=>{})},children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Copy"]}),e.jsxs(C,{variant:"ghost",size:"sm",className:"flex-1 text-xs",onClick:()=>{Promise.resolve(i("download",a)).catch(()=>{})},children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"Export"]})]})]}),s==="uploads"&&e.jsx("div",{className:"mt-3",children:e.jsxs(C,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{Promise.resolve(i("download",a)).catch(()=>{})},children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Download"]})})]})]})}function Qa({item:s,contentType:a,onAction:t,onClearSelection:l}){const[i,o]=v.useState(!1),[d,f]=v.useState(!1);if(!s)return null;const h=()=>ae(s)?s.original_name:s.title||`Untitled ${a.slice(0,-1)}`,m=()=>(console.log("getPrimaryActions called with contentType:",a),a==="uploads"?[{key:"download",label:"Download",icon:V,variant:"default"}]:a==="brands"?(console.log("Returning brand actions including Generate CV"),[{key:"view",label:"View",icon:B,variant:"default"},{key:"edit",label:"Edit",icon:de,variant:"outline"},{key:"generateCV",label:"Generate CV",icon:K,variant:"outline"}]):[{key:"view",label:"View",icon:B,variant:"default"},{key:"edit",label:"Edit",icon:de,variant:"outline"}]),x=()=>{const c=[{key:"duplicate",label:"Duplicate",icon:oe}];return a!=="uploads"&&c.push({key:"share",label:"Share",icon:se},{key:"download",label:"Export PDF",icon:V}),c.push({key:"delete",label:"Delete",icon:Pe,destructive:!0}),c},b=async c=>{if(console.log("SingleItemActions handleAction called with:",c,s),c==="delete"){o(!0);return}f(!0);try{await t(c,s),["duplicate","share","download"].includes(c)||l()}catch(p){p!=null&&p.handled||D.error(`Failed to ${c} ${a.slice(0,-1)}. Please try again.`)}finally{f(!1)}},k=async()=>{f(!0);try{await t("delete",s),l()}catch(c){c!=null&&c.handled||D.error(`Failed to delete ${a.slice(0,-1)}. Please try again.`)}finally{f(!1),o(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-primary/5 rounded-lg border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:[a==="brands"&&e.jsx(Te,{className:"w-5 h-5 text-primary"}),a==="cvs"&&e.jsx(B,{className:"w-5 h-5 text-primary"}),a==="uploads"&&e.jsx(V,{className:"w-5 h-5 text-primary"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",children:h()}),e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-1",children:[ye(s)&&s.tagline,Ds(s)&&s.summary,ae(s)&&`${s.mime_type} • ${Ss(s.size_bytes)}`]}),a==="brands"&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[ye(s)&&s.format_preset&&e.jsx(S,{variant:"outline",className:"text-xs px-1 py-0",children:s.format_preset.toUpperCase()}),"visibility"in s&&s.visibility&&e.jsx(S,{variant:"secondary",className:"text-xs px-1 py-0",children:s.visibility==="public"?"Public":"Private"})]})]})]}),e.jsx(S,{variant:"secondary",className:"text-xs",children:"1 selected"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m().map(c=>e.jsxs(C,{variant:c.variant,size:"sm",onClick:()=>{console.log("Button clicked:",c.key),b(c.key)},disabled:d,className:"gap-2",children:[e.jsx(c.icon,{className:"w-4 h-4"}),c.label]},c.key)),e.jsxs(_e,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",disabled:d,className:"gap-2",children:["More",e.jsx(rs,{className:"w-4 h-4"})]})}),e.jsx(De,{align:"end",children:x().map((c,p)=>e.jsxs("div",{children:[c.destructive&&p>0&&e.jsx(Se,{}),e.jsxs(Ae,{onClick:()=>b(c.key),className:c.destructive?"text-destructive":"",disabled:d,children:[e.jsx(c.icon,{className:"w-4 h-4 mr-2"}),c.label]})]},c.key))})]}),e.jsx(C,{variant:"ghost",size:"sm",onClick:l,disabled:d,children:"Clear"})]})]}),e.jsx(_s,{open:i,onOpenChange:o,children:e.jsxs($e,{children:[e.jsxs(Fe,{children:[e.jsxs(Ue,{children:["Delete ",h(),"?"]}),e.jsxs(Re,{children:["This action cannot be undone. This will permanently delete this ",a.slice(0,-1)," and remove it from our servers."]})]}),e.jsxs(Me,{children:[e.jsx(Ve,{disabled:d,children:"Cancel"}),e.jsx(Be,{onClick:k,disabled:d,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:d?"Deleting...":"Delete"})]})]})})]})}function Ss(s){if(!s)return"0 B";const a=["B","KB","MB","GB"],t=Math.floor(Math.log(s)/Math.log(1024));return`${(s/Math.pow(1024,t)).toFixed(1)} ${a[t]}`}function Ha({userId:s}){const[a,t]=Js(),[l,i]=v.useState(a.get("tab")||"overview"),{brands:o,cvs:d,uploads:f,refetch:h}=Ee(s);v.useEffect(()=>{const x=a.get("tab");x&&["overview","brands","cvs","uploads"].includes(x)&&i(x)},[a]);const m=x=>{i(x);const b=new URLSearchParams(a);x==="overview"?b.delete("tab"):b.set("tab",x),t(b,{replace:!0})};return e.jsxs(Ze,{value:l,onValueChange:m,className:"w-full",children:[e.jsxs(es,{className:"grid w-full grid-cols-4",children:[e.jsxs(O,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Overview"})]}),e.jsxs(O,{value:"brands",className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Brands"}),o.length>0&&e.jsx("span",{className:"ml-1 text-xs bg-muted text-muted-foreground px-1.5 py-0.5 rounded-full",children:o.length})]}),e.jsxs(O,{value:"cvs",className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"CVs"}),d.length>0&&e.jsx("span",{className:"ml-1 text-xs bg-muted text-muted-foreground px-1.5 py-0.5 rounded-full",children:d.length})]}),e.jsxs(O,{value:"uploads",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Uploads"}),f.length>0&&e.jsx("span",{className:"ml-1 text-xs bg-muted text-muted-foreground px-1.5 py-0.5 rounded-full",children:f.length})]})]}),e.jsx(q,{value:"overview",className:"mt-6",children:e.jsx(ya,{userId:s})}),e.jsx(q,{value:"brands",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Brand Riders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your professional brand documents"})]})}),e.jsx(ge,{type:"brands",items:o,onRefresh:h})]})}),e.jsx(q,{value:"cvs",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"CVs"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your generated resumes and CVs"})]})}),e.jsx(ge,{type:"cvs",items:d,onRefresh:h})]})}),e.jsx(q,{value:"uploads",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Uploads"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your uploaded source documents"})]})}),e.jsx(ge,{type:"uploads",items:f,onRefresh:h})]})})]})}const Bt=()=>{var m,x,b,k;const[s,a]=v.useState(null),[t,l]=v.useState(!0),[i,o]=v.useState(null),d=be();Ee((m=s==null?void 0:s.user)==null?void 0:m.id),v.useEffect(()=>{f();const{data:{subscription:c}}=N.auth.onAuthStateChange((p,j)=>{a(j),j||d("/auth")});return()=>c.unsubscribe()},[d]);const f=async()=>{var c,p,j;try{const{data:{session:g}}=await N.auth.getSession();if(!g){d("/auth");return}a(g);const{data:_,error:U}=await N.from("profiles").select("*").eq("id",g.user.id).single();o(_);const[T,z,Q]=await Promise.all([N.from("brands").select("id").eq("user_id",g.user.id).limit(1),N.from("cvs").select("id").eq("user_id",g.user.id).limit(1),N.from("uploads").select("id").eq("user_id",g.user.id).limit(1)]);if(!((((c=T.data)==null?void 0:c.length)||0)>0||(((p=z.data)==null?void 0:p.length)||0)>0||(((j=Q.data)==null?void 0:j.length)||0)>0)){d("/onboarding");return}l(!1)}catch(g){console.error("Error checking auth and onboarding:",g),d("/auth")}},h=async()=>{await N.auth.signOut(),d("/")};return t?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading..."})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-surface/30 backdrop-blur-sm",children:e.jsx("div",{className:"container mx-auto px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"font-heading text-2xl font-bold",children:"Brand Generator"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>d("/create"),className:"gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),"Create"]}),i&&(i.app_role==="admin"||i.app_role==="super_admin"||i.app_role==="moderator")&&e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>d("/admin"),className:"gap-2 border-orange-500 text-orange-600 hover:bg-orange-50",children:[e.jsx(ga,{className:"w-4 h-4"}),"Admin"]}),e.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>d("/profile"),className:"gap-2",children:[e.jsx(fa,{className:"w-4 h-4"}),"Profile"]}),e.jsxs(C,{variant:"ghost",size:"sm",onClick:h,className:"gap-2",children:[e.jsx(ja,{className:"w-4 h-4"}),"Sign Out"]})]})]})})}),e.jsx("main",{className:"container mx-auto px-6 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"font-heading text-3xl font-bold mb-2",children:["Welcome back, ",((b=(x=s==null?void 0:s.user)==null?void 0:x.user_metadata)==null?void 0:b.full_name)||"there","!"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your brand materials and create new content."})]}),((k=s==null?void 0:s.user)==null?void 0:k.id)&&e.jsx(Ha,{userId:s.user.id})]})})]})};export{Bt as default};
