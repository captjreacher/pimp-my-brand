var v=Object.defineProperty;var h=(c,e,a)=>e in c?v(c,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[e]=a;var n=(c,e,a)=>h(c,typeof e!="symbol"?e+"":e,a);import{F as m,A as d}from"./VoiceSynthesisDemo-CIQbSDYf.js";import{s as f}from"./index-WJiHffTg.js";import"./ui-vendor-C0wu6Ixu.js";import"./react-vendor-CaWBk0BP.js";import"./card-Dm6-Ikt0.js";import"./tabs-BYo5RIDV.js";import"./button-D17X8cRn.js";import"./cdn-cache-service-DI_aPzlR.js";import"./select-DSXyuspn.js";import"./index-CS5Pkq6r.js";import"./check-BfkMwFy4.js";import"./textarea-D8pH1jHG.js";import"./badge-DETtUbOb.js";import"./progress-BbblUuUp.js";import"./circle-alert-3PTuTpgo.js";import"./settings-DJu9X7xD.js";import"./loader-circle-C-FtpdMo.js";import"./download--9-3Bn8B.js";import"./circle-check-big-tnYyHLda.js";import"./switch-D_UTuTHZ.js";import"./supabase-vendor-ChaIFbZk.js";import"./users-Vp5rK_a6.js";import"./zap-DuWdr4El.js";import"./crown-7IjoqSw4.js";import"./router-vendor-CjcZkGkV.js";import"./query-vendor-Dx0-x9wB.js";var p={};class J{constructor(e){n(this,"providers",[]);n(this,"featureGate");this.featureGate=e,this.initializeProviders()}initializeProviders(){p.VITE_DID_API_KEY&&this.providers.push(new y(p.VITE_DID_API_KEY)),p.VITE_SYNTHESIA_API_KEY&&this.providers.push(new w(p.VITE_SYNTHESIA_API_KEY)),this.providers.push(new g)}async generateVideo(e,a,t={maxDuration:10,quality:"hd",format:"mp4",socialOptimized:!0}){if(!await m.canAccessFeature(e,d.VIDEO_GENERATION))throw new Error("Video generation requires tier 2 subscription");const i=await m.checkQuota(e,d.VIDEO_GENERATION);if(!i.canUse)throw new Error(`Video generation quota exceeded. Resets: ${i.resetDate}`);this.validateVideoConfig(a,t);let r=null;for(const s of this.providers)try{if(!await s.isAvailable())continue;console.log(`Attempting video generation with ${s.name}`);const u=await s.generateVideo(a);return await this.trackGeneration(e,s.name,a,u,!0),u}catch(l){console.error(`Video generation failed with ${s.name}:`,l),r=l,await this.trackGeneration(e,s.name,a,null,!1,l)}throw new Error(`All video providers failed. Last error: ${r==null?void 0:r.message}`)}validateVideoConfig(e,a){if(!e.script||e.script.trim().length===0)throw new Error("Script content is required");if(e.script.length>500)throw new Error("Script too long for 10-second video");if(a.maxDuration>10)throw new Error("Maximum video duration is 10 seconds")}async trackGeneration(e,a,t,o,i,r){try{await f.from("ai_generation_requests").insert({user_id:e,feature:"video_generation",provider:a,prompt:t.script,options:JSON.stringify({avatar_style:t.avatarStyle,background:t.background,animations:t.animations}),result_url:(o==null?void 0:o.url)||null,cost_cents:this.calculateCost(a),status:i?"completed":"failed",error_message:(r==null?void 0:r.message)||null}),i&&await m.trackUsage(e,d.VIDEO_GENERATION,this.calculateCost(a))}catch(s){console.error("Failed to track video generation:",s)}}calculateCost(e){return{"D-ID":500,Synthesia:300,Custom:100}[e]||100}async getAvailableAvatarStyles(){return[{id:"professional-male",name:"Professional Male",description:"Business attire, confident posture",previewUrl:"/avatars/professional-male.jpg",category:"professional"},{id:"professional-female",name:"Professional Female",description:"Business attire, approachable demeanor",previewUrl:"/avatars/professional-female.jpg",category:"professional"},{id:"casual-male",name:"Casual Male",description:"Relaxed clothing, friendly appearance",previewUrl:"/avatars/casual-male.jpg",category:"casual"},{id:"casual-female",name:"Casual Female",description:"Casual attire, warm personality",previewUrl:"/avatars/casual-female.jpg",category:"casual"},{id:"creative-male",name:"Creative Male",description:"Artistic style, expressive gestures",previewUrl:"/avatars/creative-male.jpg",category:"creative"},{id:"creative-female",name:"Creative Female",description:"Unique style, dynamic presence",previewUrl:"/avatars/creative-female.jpg",category:"creative"}]}async getBackgroundOptions(){return[{id:"office",name:"Modern Office",description:"Clean, professional workspace",previewUrl:"/backgrounds/office.jpg",category:"professional"},{id:"studio",name:"Studio",description:"Neutral background with soft lighting",previewUrl:"/backgrounds/studio.jpg",category:"neutral"},{id:"home-office",name:"Home Office",description:"Comfortable, personal workspace",previewUrl:"/backgrounds/home-office.jpg",category:"casual"},{id:"creative-space",name:"Creative Space",description:"Artistic environment with vibrant colors",previewUrl:"/backgrounds/creative-space.jpg",category:"creative"},{id:"outdoor",name:"Outdoor",description:"Natural setting with soft focus",previewUrl:"/backgrounds/outdoor.jpg",category:"natural"}]}}class y{constructor(e){n(this,"name","D-ID");n(this,"apiKey");n(this,"baseUrl","https://api.d-id.com");this.apiKey=e}async isAvailable(){try{return(await fetch(`${this.baseUrl}/clips`,{method:"GET",headers:{Authorization:`Basic ${this.apiKey}`,"Content-Type":"application/json"}})).ok}catch{return!1}}async generateVideo(e){const a={script:{type:"text",input:e.script,provider:{type:"microsoft",voice_id:"en-US-JennyNeural"}},presenter_config:{type:"clip",presenter_id:this.mapAvatarToPresenter(e.avatarStyle.id)},background:{color:e.background.color||"#ffffff"},config:{result_format:"mp4",fluent:!0,pad_audio:0}},t=await fetch(`${this.baseUrl}/clips`,{method:"POST",headers:{Authorization:`Basic ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error(`D-ID API error: ${t.statusText}`);const o=await t.json(),i=await this.pollForCompletion(o.id);return{id:o.id,url:i,duration:10,format:"mp4",provider:"D-ID",metadata:{avatarStyle:e.avatarStyle,background:e.background,script:e.script}}}mapAvatarToPresenter(e){return{"professional-male":"amy-jcwCkr1grs","professional-female":"amy-Aq6OmGZnMt","casual-male":"amy-jcwCkr1grs","casual-female":"amy-Aq6OmGZnMt","creative-male":"amy-jcwCkr1grs","creative-female":"amy-Aq6OmGZnMt"}[e]||"amy-jcwCkr1grs"}async pollForCompletion(e){for(let o=0;o<30;o++){const i=await fetch(`${this.baseUrl}/clips/${e}`,{headers:{Authorization:`Basic ${this.apiKey}`}});if(!i.ok)throw new Error(`Failed to check clip status: ${i.statusText}`);const r=await i.json();if(r.status==="done")return r.result_url;if(r.status==="error")throw new Error(`Video generation failed: ${r.error}`);await new Promise(s=>setTimeout(s,2e3))}throw new Error("Video generation timed out")}}class w{constructor(e){n(this,"name","Synthesia");n(this,"apiKey");n(this,"baseUrl","https://api.synthesia.io/v2");this.apiKey=e}async isAvailable(){try{return(await fetch(`${this.baseUrl}/videos`,{method:"GET",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"}})).ok}catch{return!1}}async generateVideo(e){const a={test:!1,visibility:"private",aspectRatio:"16:9",title:"Brand Presentation",description:"AI-generated brand rider presentation",scenes:[{background:e.background.url||"#ffffff",elements:[{type:"avatar",avatar:this.mapAvatarToSynthesia(e.avatarStyle.id),script:e.script,x:0,y:0,width:1,height:1}]}]},t=await fetch(`${this.baseUrl}/videos`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error(`Synthesia API error: ${t.statusText}`);const o=await t.json(),i=await this.pollForCompletion(o.id);return{id:o.id,url:i,duration:10,format:"mp4",provider:"Synthesia",metadata:{avatarStyle:e.avatarStyle,background:e.background,script:e.script}}}mapAvatarToSynthesia(e){return{"professional-male":"anna_costume1_cameraA","professional-female":"anna_costume1_cameraA","casual-male":"anna_costume2_cameraA","casual-female":"anna_costume2_cameraA","creative-male":"anna_costume3_cameraA","creative-female":"anna_costume3_cameraA"}[e]||"anna_costume1_cameraA"}async pollForCompletion(e){for(let o=0;o<60;o++){const i=await fetch(`${this.baseUrl}/videos/${e}`,{headers:{Authorization:`Bearer ${this.apiKey}`}});if(!i.ok)throw new Error(`Failed to check video status: ${i.statusText}`);const r=await i.json();if(r.status==="complete")return r.download;if(r.status==="failed")throw new Error(`Video generation failed: ${r.error}`);await new Promise(s=>setTimeout(s,5e3))}throw new Error("Video generation timed out")}}class g{constructor(){n(this,"name","Custom")}async isAvailable(){return!0}async generateVideo(e){const a=`custom_${Date.now()}`;return await new Promise(t=>setTimeout(t,3e3)),{id:a,url:`/api/videos/${a}.mp4`,duration:10,format:"mp4",provider:"Custom",metadata:{avatarStyle:e.avatarStyle,background:e.background,script:e.script,note:"Generated using custom avatar system"}}}}export{J as VideoGenerationService};
