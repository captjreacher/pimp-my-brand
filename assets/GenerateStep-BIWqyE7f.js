import{j as e}from"./ui-vendor-D6k6xAJg.js";import{r as c}from"./react-vendor-CbTYwD9p.js";import{B as r}from"./button-ro640sRo.js";import{s as a,a as C}from"./index-CWAcGGyY.js";import{C as ee}from"./CVSourceStep-SzsfMP3N.js";import{u as se}from"./router-vendor-BssJdvT9.js";import{C as te}from"./circle-alert-BsLtj5ny.js";import{H as k}from"./house-B68BO0Xt.js";import{A as U}from"./arrow-left-Dbu1FBX4.js";import{S as P}from"./sparkles-3Bp2-477.js";import{F as T}from"./file-text-DjzqkRut.js";import{L as re}from"./loader-circle-Etq7a_Nb.js";import"./supabase-vendor-CYMOQS5a.js";import"./query-vendor-CKaEIWod.js";import"./card-CfRzuJdW.js";import"./checkbox-DdgIFkyO.js";import"./index-2c6_cF8I.js";import"./check-Cp6OSBFl.js";import"./badge-DYFFvGV6.js";import"./input-DlTyRBPh.js";import"./tabs-D4HRQBSG.js";import"./search-BT7zR4Ws.js";import"./upload-BHSn4587.js";import"./calendar-BAG2bnGU.js";function Ge({corpus:d,uploadIds:_,format:u,logoUrl:M,onComplete:E,onBrandDataGenerated:D}){const j=se(),[h,f]=c.useState(!1),[O,x]=c.useState(""),[A,Y]=c.useState(!1),[y,I]=c.useState(""),[S,L]=c.useState(!1),[z,N]=c.useState(!1),[H,V]=c.useState(!1),[R,w]=c.useState(null),G=async()=>{var b;f(!0),w(null);try{const{data:{user:o}}=await a.auth.getUser();if(!o)throw new Error("Not authenticated");x("Analyzing your writing style...");const n=await a.functions.invoke("generate-style",{body:{corpus:d}});if(n.error)throw n.error;const s=n.data;x("Creating visual identity...");const i=await a.functions.invoke("generate-visual",{body:{keywords:((b=s.tone)==null?void 0:b.adjectives)||[],roleTags:[],bio:s.bio||""}});if(i.error)throw i.error;const l=i.data;D&&D({...s,...l}),x("Assembling your Brand Rider...");const m=await a.functions.invoke("generate-brand",{body:{styleData:s,visualData:l,format:u}});if(m.error)throw m.error;const{markdown:p}=m.data;x("Saving your brand...");const{data:t,error:v}=await a.from("brands").insert({user_id:o.id,title:s.tagline||"My Brand",tagline:s.tagline,tone_notes:JSON.stringify(s.tone),signature_phrases:s.signature_phrases,strengths:s.strengths,weaknesses:s.weaknesses,bio:s.bio,color_palette:l.palette,fonts:l.fonts,format_preset:u,logo_url:M,raw_context:{uploadIds:_,markdown:p,styleData:s,visualData:l}}).select().single();if(v)throw v;I(t.id),Y(!0),f(!1),N(!0),C.success("Brand generated successfully!")}catch(o){console.error("Generation error:",o);const n=o.message||"Failed to generate brand";w(n),C.error(n),f(!1)}},q=()=>{N(!1),V(!0)},W=async(b,o)=>{var n;if(y){f(!0),L(!0),V(!1);try{const{data:{user:s}}=await a.auth.getUser();if(!s)throw new Error("Not authenticated");const{data:i,error:l}=await a.from("brands").select("*").eq("id",y).single();if(l)throw l;const m=i.raw_context,p=m==null?void 0:m.styleData;if(!p)throw new Error("Style data not found");const{data:t}=await a.from("profiles").select("*").eq("id",s.id).single(),v={name:(t==null?void 0:t.display_name)||"Professional Name",role:((n=t==null?void 0:t.role_tags)==null?void 0:n[0])||"Professional",bio:(t==null?void 0:t.bio)||p.bio,links:t!=null&&t.socials?Object.entries(t.socials).map(([X,Z])=>({label:X,url:Z})):[]};x("Generating your professional CV...");const K=d+(o?`

`+o:""),B=await a.functions.invoke("generate-cv",{body:{styleData:p,extractedText:K,format:u,userProfile:v,sourceUploadIds:b}});if(B.error)throw B.error;const g=B.data;x("Saving your CV...");const{data:Q,error:F}=await a.from("cvs").insert({user_id:s.id,title:`${g.name} - CV`,summary:g.summary,experience:g.experience,skills:g.skills,links:g.links,format_preset:u}).select().single();if(F)throw F;C.success("CV generated successfully!"),E(y,Q.id)}catch(s){console.error("CV generation error:",s);const i=s.message||"Failed to generate CV";w(i),C.error(i),f(!1),N(!0)}}},J=()=>{E(y)},$=()=>{V(!1),N(!0)};return R&&!h?e.jsxs("div",{className:"space-y-6 text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(te,{className:"w-8 h-8 text-red-600"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"font-heading text-3xl",children:"Generation Failed"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"We encountered an error while generating your brand. This might be due to a temporary issue with our services."})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-left max-w-md mx-auto",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium mb-2",children:"Error Details:"}),e.jsx("p",{className:"text-xs text-red-700",children:R})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx(r,{onClick:()=>{w(null),G()},className:"flex items-center gap-2",children:"Try Again"}),e.jsxs(r,{variant:"outline",onClick:()=>j("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Go to Dashboard"]}),e.jsxs(r,{variant:"outline",onClick:()=>window.location.reload(),className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Start Over"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"If this problem persists, please try uploading different content or contact support."})]}):H&&A?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:$,className:"gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-heading text-2xl",children:"Generate Your CV"}),e.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 px-3 py-1 rounded-full",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:"Step 4 of 4"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Using your brand style: ",e.jsx("span",{className:"font-medium text-foreground",children:u.toUpperCase()})," format"]})]})]}),e.jsx(ee,{brandCorpus:d,brandUploadIds:_,onComplete:W})]}):z&&A?e.jsxs("div",{className:"space-y-8 text-center py-12",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(P,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"font-heading text-3xl",children:"Brand Created Successfully!"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto mb-4",children:"Your Brand Rider is ready. Would you also like to generate a professional CV using the same style and format?"}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-green-600 text-xs font-bold",children:"âœ¨"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 mb-1",children:"Smart CV Generation"}),e.jsx("p",{className:"text-xs text-green-700",children:"Choose from your uploaded documents and add more content for a comprehensive CV"})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsxs(r,{onClick:q,className:"flex items-center gap-2",disabled:h,children:[e.jsx(T,{className:"w-4 h-4"}),"Generate CV"]}),e.jsx(r,{variant:"outline",onClick:J,disabled:h,children:"Skip for Now"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can always generate a CV later from your dashboard"})]}):!d||!d.trim()?e.jsxs("div",{className:"space-y-6 text-center py-12",children:[e.jsx("h2",{className:"font-heading text-3xl",children:"Missing Content"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"No content was provided for brand generation. Please go back and upload some files first."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx(r,{onClick:()=>window.location.reload(),children:"Restart Process"}),e.jsxs(r,{variant:"outline",onClick:()=>j("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Go to Dashboard"]}),e.jsxs(r,{variant:"outline",onClick:()=>j("/"),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Go Home"]})]})]}):d.length<100?e.jsxs("div",{className:"space-y-6 text-center py-12",children:[e.jsx("h2",{className:"font-heading text-3xl",children:"Limited Content"}),e.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto",children:["The uploaded content is very short (",d.length," characters). For better results, please upload more substantial content like resumes, writing samples, or project descriptions."]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto",children:[e.jsx(r,{onClick:G,children:"Generate Anyway"}),e.jsx(r,{variant:"outline",onClick:()=>window.location.reload(),children:"Upload More Content"}),e.jsxs(r,{variant:"outline",onClick:()=>j("/dashboard"),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Go to Dashboard"]})]})]}):e.jsxs("div",{className:"space-y-6 text-center py-12",children:[e.jsx("div",{className:"relative",children:S?e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"w-16 h-16 mx-auto text-primary animate-pulse"}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:"ðŸ“„"})})]}):e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"w-16 h-16 mx-auto text-primary animate-pulse"}),e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs",children:"âœ¨"})})]})}),e.jsx("h2",{className:"font-heading text-3xl",children:S?"Creating Your CV":"Creating Your Brand"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto mb-4",children:O}),h&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(re,{className:"w-8 h-8 mx-auto animate-spin text-primary"}),e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-3 max-w-sm mx-auto",children:e.jsx("p",{className:"text-xs text-primary text-center",children:S?"Analyzing documents and generating CV...":"Processing your content..."})})]}),!h&&e.jsx(r,{onClick:G,className:"mt-4",children:"Start Brand Generation"})]})}export{Ge as GenerateStep};
